<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Anil Madhavapeddy, Gemma Gordon, KC Sivaramakrishnan" />
  <title>OCaml Labs Annual Reviews (2011-2014)</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="github-pandoc.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">OCaml Labs Annual Reviews (2011-2014)</h1>
<h2 class="author">Anil Madhavapeddy, Gemma Gordon, KC Sivaramakrishnan</h2>
</div>
<div id="TOC">
<ul>
<li><a href="#in-review">2014 In Review</a><ul>
<li><a href="#tooling">Tooling</a></li>
<li><a href="#core-compiler">Core Compiler</a></li>
<li><a href="#community-and-teaching-efforts">Community and Teaching Efforts</a></li>
<li><a href="#research-efforts">Research Efforts</a></li>
<li><a href="#priorities-for-2015">Priorities for 2015</a></li>
</ul></li>
<li><a href="#in-review-1">2013 in Review</a><ul>
<li><a href="#tooling-1">Tooling</a></li>
<li><a href="#core-compiler-1">Core Compiler</a></li>
<li><a href="#community-efforts">Community Efforts</a></li>
<li><a href="#research-projects">Research Projects</a></li>
<li><a href="#priorities-for-2014">Priorities for 2014</a></li>
</ul></li>
</ul>
</div>
<p>These are annual reviews of the activities of OCaml Labs – an initiative within the Cambridge Computer Laboratory started by Anil Madhavapeddy in 2011 to promote research, growth and collaboration within the wider OCaml community. We contribute to management of the day-to-day OCaml maintenance load, and align research agendas with real-world projects to help progress the language and make it available and applicable to a larger audience. Together with INRIA and our other partners, our goal is to freely release and integrate all work upstream, allowing all prospective users access to the efficient, expressive language of OCaml.</p>
<h2 id="in-review">2014 In Review</h2>
<p>The <a href="http://ocaml.io">OCaml Labs</a> initiative within the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Laboratory</a> is now just over two years old, and it is time for an update about our activities since the last update at the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Dec%202013">end of 2013</a> and <a href="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html">2012</a>.</p>
<p>The theme of our group was not to be pure research, but rather a hybrid group that takes on some of the load of day-to-day OCaml maintenance from <a href="http://caml.inria.fr/">INRIA</a>, as well as help grow the wider community and meet our own research agendas around topics such as <a href="https://queue.acm.org/detail.cfm?id=2566628">unikernels</a>. To this end, all of our projects have been highly collaborative, often involving colleagues from <a href="http://ocamlpro.com">OCamlPro</a>, <a href="http://caml.inria.fr/">INRIA</a>, <a href="http://janestreet.com">Jane Street</a>, <a href="http://lexifi.com">Lexifi</a> and <a href="http://citrix.com">Citrix</a>.</p>
<p>This post covers our progress in tooling, the compiler and language, community efforts, research projects and concludes with our priorities for 2015.</p>
<h3 id="tooling">Tooling</h3>
<p>At the start of 2014, we had just helped to release <a href="http://opam.ocaml.org/blog/opam-1-1-1-released/">OPAM 1.1.1</a> with our colleagues at <a href="http://ocamlpro.com">OCamlPro</a>, and serious OCaml users had just started moving over to using it.</p>
<p>Our overall goal at OCaml Labs is to deliver a modular set of of development tools around OCaml that we dub the <em>OCaml Platform</em>. The remainder of 2014 was thus spent polishing this nascent OPAM release into a solid base (both as a command-line tool and as a library) that we could use as the basis for documentation, testing and build infrastructure, all the while making sure that bigger OCaml projects continued to migrate over to it. Things have been busy; here are the highlights of this effort.</p>
<h4 id="opam">OPAM</h4>
<p>The central <a href="https://github.com/ocaml/opam-repository">OPAM repository</a> that contains the package descriptions has grown tremendously in 2014, with over 280 contributors committing almost 10000 changesets across 3800 <a href="https://github.com/ocaml/opam-repository/pulls">pull requests</a> on GitHub. The front line of incoming testing has been continuous integration by the wonderful <a href="http://travis-ci.org/ocaml/opam-repository">Travis CI</a>, who also granted us access to their experimental <a href="http://docs.travis-ci.com/user/osx-ci-environment/">MacOS X</a> build pool. The OPAM package team also to expanded to give David Sheets, Jeremy Yallop, Peter Zotov and Damien Doligez commit rights, and they have all been busily triaging new packages as they come in.</p>
<p>Several large projects such as <a href="http://xapi-project.github.io/">Xapi</a>, <a href="http://ocsigen.org">Ocsigen</a> and our own <a href="http://openmirage.org">MirageOS</a> switched over to using OPAM for day-to-day development, as well as prolific individual developers such as <a href="http://erratique.ch">Daniel Buenzli</a> and <a href="http://ocaml.info/">Markus Mottl</a>. <a href="https://blogs.janestreet.com/category/ocaml/">Jane Street</a> continued to send regular <a href="https://github.com/ocaml/opam-repository/pulls?utf8=%E2%9C%93&amp;q=is%3Apr+author%3Adiml+">monthly updates</a> of their Core/Async suite, and releases appeared from the <a href="https://github.com/ocaml/opam-repository/pull/3570">Facebook</a> open-source team as well (who develop <a href="https://code.facebook.com/posts/264544830379293/hack-a-new-programming-language-for-hhvm/">Hack</a>, <a href="https://github.com/facebook/flow">Flow</a> and <a href="https://github.com/facebook/pfff">Pfff</a> in OCaml).</p>
<div class="figure">
<img src="graphics/ocl14rev/opam12-contributors-mar14.png" alt="Number of unique contributors to the central OPAM package repository" />
<p class="caption">Number of unique contributors to the central OPAM package repository</p>
</div>
<div class="figure">
<img src="graphics/ocl14rev/opam12-packages-mar14.png" alt="Total number of unique packages (including multiple versions of the same package)" />
<p class="caption">Total number of unique packages (including multiple versions of the same package)</p>
</div>
<div class="figure">
<img src="graphics/ocl14rev/opam12-unique-packages-mar14.png" alt="Total packages with multiple versions coalesced so you can see new package growth" />
<p class="caption">Total packages with multiple versions coalesced so you can see new package growth</p>
</div>
<p>We used feedback from the users to smooth away many of the rough edges, with:</p>
<ul>
<li>a redesigned <a href="http://opam.ocaml.org/blog/opam-1-2-pin/">development workflow</a> that lets developers quickly grab a development version of a library recompile all dependent packages automatically, and quickly publish results to GitHub.</li>
<li>binary distributions for common OS distributions via their <a href="https://github.com/ocaml/opam/wiki/Distributions">native packaging</a>, as well as <a href="http://opam.ocaml.org/blog/0install-intro/">0install</a> and <a href="https://github.com/mirage/mirage-vagrant-vms">Vagrant boxes</a>.</li>
<li>a unified way of cloning the source of any package via <code>opam source</code>. This handles any supported OPAM archive, including Git, Mercurial or Darcs remotes.</li>
<li>a richer package metadata, including source code, development archives and bug report URLs.</li>
</ul>
<p>These changes were all incorporated into the <a href="http://opam.ocaml.org/blog/opam-1-2-0-release/">OPAM 1.2</a>, along with backwards compatibility shims to keep the old 1.1 metadata format working until the migration is complete. The 1.2.x series has been a solid and usable development manager, and last week’s release of <a href="http://opam.ocaml.org/blog/opam-1-2-1-release/">OPAM 1.2.1</a> has further polished the core scripting engine.</p>
<h5 id="platform-blog">Platform Blog</h5>
<p>One of the more notable developments during 2014 was the <a href="http://coq-blog.clarus.me/use-opam-for-coq.html">adoption of OPAM</a> further up the ecosystem by the <a href="https://coq.inria.fr/">Coq</a> theorem prover. This broadening of the community prompted us to create an <a href="http://opam.ocaml.org">official OPAM blog</a> to give us a central place for new and tips, and we’ve had posts about <a href="http://opam.ocaml.org/blog/opam-in-xenserver/">XenServer</a> developments, the <a href="http://opam.ocaml.org/blog/turn-your-editor-into-an-ocaml-ide/">Merlin IDE tool</a> and the modern <a href="http://opam.ocaml.org/blog/about-utop/">UTop</a> interactive REPL. If you are using OPAM in an interesting or production capacity, please do <a href="https://github.com/ocaml/platform-blog/issues">get in touch</a> so that we can work with you to write about it for the wider community.</p>
<p>The goal of the blog is also to start bringing together the various components that form the OCaml Platform. These are designed to be modular tools (so that you can pick and choose which ones are necessary for your particular use of OCaml). There are more details available from the OCaml Workshop presentation at ICFP 2014 (<a href="https://ocaml.org/meetings/ocaml/2014/ocaml2014_7.pdf">abstract</a>, <a href="https://ocaml.org/meetings/ocaml/2014/ocl-platform-2014-slides.pdf">slides</a>, <a href="https://www.youtube.com/watch?v=jxhtpQ5nJHg&amp;list=UUP9g4dLR7xt6KzCYntNqYcw">video</a>).</p>
<h5 id="onboarding-new-users">Onboarding New Users</h5>
<p>OPAM has also been adopted now by <a href="http://harvard.edu">several</a> <a href="http://cornell.edu">big</a> <a href="http://princeton.edu">universities</a> (including <a href="http://www.cl.cam.ac.uk/teaching/1415/L28/">us at Cambridge</a>!) for undergraduate and graduate Computer Science courses. The demands increased for an out-of-the-box solution that makes it as easy possible for new users to get started with minimum hassle. We created a <a href="http://lists.ocaml.org/listinfo/teaching">dedicated teaching list</a> to aid collaboration, and a list of <a href="http://ocaml.org/learn/teaching-ocaml.html">teaching resources on ocaml.org</a> and supported several initiatives in collaboration with <a href="https://github.com/AltGr">Louis Gesbert</a> at OCamlPro, as usual with OPAM development).</p>
<p>The easiest way to make things “just work” are via regular binary builds of the latest releases of OCaml and OPAM on Debian, Ubuntu, CentOS and Fedora, via <a href="http://launchpad.net/~avsm">Ubuntu PPAs</a> and the <a href="https://build.opensuse.org/package/show/home:ocaml/opam">OpenSUSE Build Service</a> repositories. Our industrial collaborators from Citrix, <a href="http://jon.recoil.org">Jon Ludlam</a> and <a href="http://dave.recoil.org">Dave Scott</a> began an <a href="http://lists.ocaml.org/pipermail/opam-devel/2015-January/000910.html">upstreaming initiative</a> to Fedora and sponsored the creation of a <a href="http://lists.centos.org/pipermail/centos-devel/2014-November/012375.html">CentOS SIG</a> to ensure that binary packages remain up-to-date. We also contribute to the hardworking packagers on MacOS X, Debian, FreeBSD, NetBSD and OpenBSD where possible as well to ensure that binary builds are well rounded out. Richard Mortier also assembled <a href="https://github.com/mirage/mirage-vagrant-vms">Vagrant boxes</a> that contain OCaml, for use with VirtualBox.</p>
<div class="figure">
<img src="graphics/ocl14rev/opam-in-nice-thumb.jpg" alt="Louis cooks us dinner in Nice at our OPAM developers" />
<p class="caption">Louis cooks us dinner in Nice at our OPAM developers</p>
</div>
<p>Within OPAM itself, we applied polish to the handling of <a href="https://github.com/ocaml/opam-depext">external dependencies</a> to automate checking that the system libraries required by OPAM are present. Two emerging tools that should help further in 2015 are the <a href="https://github.com/OCamlPro/opam-user-setup">opam-user-setup</a> and <a href="https://github.com/ocaml/opam/issues/1035">OPAM-in-a-box</a> plugins that automate first-time configuration. These last two are primarily developed at OCamlPro, with design input and support from OCaml Labs.</p>
<p>We do have a lot of work left to do with making the new user experience really seamless, and help is <em>very</em> welcome from anyone who is interested. It often helps to get the perspective of a newcomer to find out where the stumbling blocks are, and we value any such advice. Just mail <script type="text/javascript">
<!--
h='&#108;&#x69;&#x73;&#116;&#x73;&#46;&#x6f;&#x63;&#x61;&#x6d;&#108;&#46;&#x6f;&#114;&#x67;';a='&#64;';n='&#x6f;&#112;&#x61;&#x6d;&#x2d;&#100;&#x65;&#118;&#x65;&#108;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#x6f;&#112;&#x61;&#x6d;&#x2d;&#100;&#x65;&#118;&#x65;&#108;&#32;&#x61;&#116;&#32;&#108;&#x69;&#x73;&#116;&#x73;&#32;&#100;&#x6f;&#116;&#32;&#x6f;&#x63;&#x61;&#x6d;&#108;&#32;&#100;&#x6f;&#116;&#32;&#x6f;&#114;&#x67;</noscript> with your thoughts, or <a href="https://github.com/ocaml/opam/issues">create an issue</a> on how we can improve. A particularly good example of such an initiative was started by Jordan Walke, who prototyped <a href="https://github.com/jordwalke/CommonML">CommonML</a> with a NodeJS-style development workflow, and <a href="http://lists.ocaml.org/pipermail/opam-devel/2015-February/000975.html">wrote up</a> his design document for the mailing list. (Your questions or ideas do not need to be as well developed as Jordan’s prototype!)</p>
<h4 id="testing-packages">Testing Packages</h4>
<p><img src="graphics/travis-mascot-200px.png" alt="Travis Mascot" class="floater" /> The public Travis CI testing does come with some limitations, since it only checks that the latest package sets install, but not if any transitive dependencies fail due to interface changes. It also doesn’t test all the optional dependency combinations due to the 50 minute time limit.</p>
<p>We expanded the OPAM repository testing in several ways to get around this:</p>
<ul>
<li><p><strong>Individual Repositories:</strong> Thomas Gazagnaire built <a href="http://opam.ocaml.org/blog/opam-1-2-travisci/">centralised Travis scripts</a> that can be used on any OCaml GitHub repository to easily test code before it is released into OPAM. These scripts are sourced from a central <a href="https://github.com/ocaml/ocaml-travisci-skeleton">repository</a> and support external, optional and reverse dependency checking across multiple revisions of the compiler. For instance, it just needs <a href="https://github.com/mirage/ocaml-cohttp/blob/master/.travis.yml">one file</a> to test all the supported permutations of the <a href="https://github.com/mirage/ocaml-cohttp">CoHTTP</a> library.</p></li>
<li><p><strong>Bulk Builds</strong>: Damien Doligez and I independently started doing large-scale bulk builds of the repository to ensure that a single snapshot of the package repository can automatically build as many packages as possible. My implementation used the <a href="http://docker.com">Docker</a> container manager to spawn off 1000s of package builds in parallel and commit the results into a filesystem This required building a <a href="http://avsm.github.io/ocaml-dockerfile">Dockerfile eDSL</a>, and the results are now online at <a href="https://opam.ocaml.org/builds" class="uri">https://opam.ocaml.org/builds</a>.</p></li>
<li><p><strong>OCamlot</strong>: An ongoing piece of infrastructure work is to take the bulk build logs (which are around 7GB per daily run), and to store and render them using our <a href="http://irmin.io">Irmin</a> Git store. Expect to see more around this soon; it has the awesome feature of letting any developer clone the build logs for their project locally, to make triage of foreign operating systems as simple as possible.</p></li>
</ul>
<h6 id="language-evolution">Language Evolution</h6>
<p>This ability to do unattended builds of the package repository has also improved the decision making process within the core compiler team. Since we now have a large (3000+ package) corpus of OCaml code, it became a regular occurrence in the 4.02 development cycle to “<a href="http://anil.recoil.org/2014/04/08/grepping-every-known-ocaml-package-source.html">ask OPAM</a>” whether a particular feature or new syntax would break any existing code. This in turn provides an incentive for commercial users to provide representative samples of their code; for instance, the Jane Street Core releases in OPAM (with their very modular style) act as an open-source canary without needing access to any closed source code.</p>
<p>One good example in 2014 was the decoupling of the <a href="http://en.wikipedia.org/wiki/Camlp4">Camlp4</a> macro preprocessor from the main OCaml distribution. Since Camlp4 has been used for over a decade and there are some very commonly used syntax extensions such as <a href="https://github.com/janestreet/type_conv">type_conv</a>, a simple removal would break a lot of packages. We used OPAM to perform a gradual movement that most users hopefully never noticed by the time OCaml 4.02 was released. First, we added a <a href="https://github.com/ocaml/opam-repository/pull/2558">dummy package</a> in OPAM for earlier versions of the compiler that had Camlp4 built-in, and then used the OPAM constraint engine to compile it as an external tool for the newer compiler revisions. Then we just had to triage the bulk build logs to find build failures from packages that were missing a Camlp4 dependency, and <a href="https://github.com/ocaml/opam-repository/pulls?utf8=%E2%9C%93&amp;q=camlp4+requires+is%3Apr+">add them</a> to the package metadata.</p>
<h5 id="github-integration">GitHub Integration</h5>
<p>An interesting <a href="https://twitter.com/vincenthz/status/563108158907097089">comment</a> from Vincent Hanquez about OPAM is that “OCaml’s OPAM is a post-GitHub design”. This is very true, as much of the workflow for pinning <code>git://</code> URLs emerged out of being early adopters of GitHub for hosting the MirageOS. OCaml Labs supported two pieces of infrastructure integration around GitHub in 2014:</p>
<ul>
<li><p>OPAM has a compiler switch feature that lets you run simultaneous OCaml installations and swap between them easily. I used my <a href="https://github.com/avsm/ocaml-github">GitHub API bindings</a> to regularly convert every GitHub pull request into <a href="http://anil.recoil.org/2014/03/25/ocaml-github-and-opam.html">a custom compiler switch</a>. This lets users reporting bugs try out a patched compiler almost immediately upon a fix becoming available.</p></li>
<li><p>The motivation behind this feature was our collaborator Gabriel Scherer’s <a href="http://gallium.inria.fr/blog/patch-review-on-github/">experiment</a> to enable patch review of OCaml on GitHub, alongside the venerable <a href="http://caml.inria.fr/mantis/view_all_bug_page.php">Mantis bug tracker</a>. We supported this via adding Travis CI support to the main compiler, and also helped to migrate a number of support libraries to GitHub, such as <a href="https://github.com/ocaml/camlp4">camlp4</a>. These can all be found on the <a href="https://github.com/ocaml">ocaml</a> organisation on GitHub.</p></li>
</ul>
<h4 id="codoc-documentation">Codoc Documentation</h4>
<iframe style="float: right; padding-left: 15px" width="200" height="150" src="https://www.youtube.com/embed/jxhtpQ5nJHg?rel=0" frameborder="0" allowfullscreen="allowfullscreen">
</iframe>
<p>Leo White, David Sheets, Amir Chaudhry and Thomas Gazagnaire led the charge to build a modern documentation generator for OCaml, and <a href="http://lists.ocaml.org/pipermail/platform/2015-February/000539.html">published</a> an <em>alpha</em> version of <a href="https://github.com/dsheets/codoc">codoc 0.2.0</a> after a lot of work throughout 2014. In the 2014 OCaml workshop presentation (<a href="http://ocaml.org/meetings/ocaml/2014/ocaml2014_7.pdf">abstract</a>, <a href="http://ocaml.org/meetings/ocaml/2014/ocl-platform-2014-slides.pdf">slides</a>, <a href="https://www.youtube.com/watch?v=jxhtpQ5nJHg&amp;list=UUP9g4dLR7xt6KzCYntNqYcw">video</a>), we mentioned the “module wall” for documentation and this attempts to fix it. To try it out, simply follow the directions in the README on that repository, or <a href="http://dsheets.github.io/codoc">browse some samples</a> of the current, default output of the tool. Please do bear in mind codoc and its constituent libraries are still under heavy development and are <em>not</em> feature complete, but we’re gathering <a href="https://github.com/dsheets/codoc/issues">feedback</a> from early adopters.</p>
<p><code>codoc</code>’s aim is to provide a widely useful set of tools for generating OCaml documentation. In particular, we are striving to:</p>
<ol style="list-style-type: decimal">
<li>Cover all of OCaml’s language features</li>
<li>Provide accurate name resolution and linking</li>
<li>Support cross-linking between different packages</li>
<li>Expose interfaces to the components we’ve used to build <code>codoc</code></li>
<li>Provide a magic-free command-line interface to the tool itself</li>
<li>Reduce external dependencies and default integration with other tools</li>
</ol>
<p>We haven’t yet achieved all of these at all levels of our tool stack but are getting close, and the patches are all under discussion for integration into the mainstream OCaml compiler. <code>codoc</code> 0.2.0 is usable today (if a little rough in some areas like default CSS), and there is a <a href="http://opam.ocaml.org/blog/codoc-0-2-0-released/">blog post</a> that outlines the architecture of the new system to make it easier to understand the design decisions that went into it.</p>
<h4 id="community-governance">Community Governance</h4>
<p>As the amount of infrastructure built around the <a href="http://ocaml.org">ocaml.org</a> domain grows (e.g. mailing lists, file hosting, bulk building), it is important to establish a governance framework to ensure that it is being used as best needed by the wider OCaml community.</p>
<p>Amir Chaudhry took a good look at how other language communities organise themself, and began putting together a succinct <a href="http://amirchaudhry.com/towards-governance-framework-for-ocamlorg/">governance framework</a> to capture how the community around <code>ocaml.org</code> operates, and how to quickly resolve any conflicts that may arise in the future. He took care to ensure it had a well-defined scope, is simple and self-contained, and (crucially) documents the current reality. The result of this work is circulating privately through all the existing volunteers for a first round of feedback, and will go live in the next few months as a living document that explains how our community operates.</p>
<h4 id="assemblage">Assemblage</h4>
<p>One consequence of OCaml’s age (close to twenty years old now) is that the tools built around the compiler have evolved fairly independently. While OPAM now handles the high-level package management, there is quite a complex ecosystem of other components that are complex for new users to get to grips with: <a href="http://github.com/ocaml/oasis">OASIS</a>, <a href="http://projects.camlcity.org/projects/findlib.html">ocamlfind</a>, <a href="https://ocaml.org/learn/tutorials/ocamlbuild/">ocamlbuild</a>, and <a href="https://github.com/the-lambda-church/merlin">Merlin</a> to name a few. Each of these components (while individually stable) have their own metadata and namespace formats, further compounding the lack of cohesion of the tools.</p>
<p>Thomas Gazagnaire and Daniel Buenzli embarked on an effort to build an eDSL that unifies OCaml package descriptions, with the short-term aim of generating the support files required by the various support tools, and the long-term goal of being the integration point for the build, test and documentation generation lifecycle of an OCaml/OPAM package. This prototype, dubbed <a href="https://github.com/samoht/assemblage">Assemblage</a> has gone through several iterations and <a href="https://github.com/samoht/assemblage/labels/design">design discussions</a> over the summer of 2014. Daniel has since been splitting out portions of it into the <a href="http://erratique.ch/software/bos">Bos</a> OS interaction library.</p>
<p>Assemblage is not released officially yet, but we are committed to resuming work on it this summer when Daniel visits again, with the intention of unifying much of our workflow through this tool. If you are interested in build and packaging systems, now is the time to <a href="https://github.com/samoht/assemblage">make your opinion known</a>!</p>
<h3 id="core-compiler">Core Compiler</h3>
<p>We also spent time in 2014 working on the core OCaml language and compiler, with our work primarily led by Jeremy Yallop and Leo White. These efforts were not looking to make any radical changes in the core language; instead, we generally opted for evolutionary changes that either polish rough edges in the language (such as open type and handler cases), or new features that fit into the ML style of building programs.</p>
<h4 id="new-features-in-4.02.0">New Features in 4.02.0</h4>
<p>The OCaml 4.02 series was primarily developed and <a href="https://ocaml.org/releases/4.02.html">released</a> in 2014. The <a href="http://caml.inria.fr/pub/distrib/ocaml-4.02/notes/Changes">ChangeLog</a> generated much <a href="https://blogs.janestreet.com/ocaml-4-02-everything-else/">user excitement</a>, and we were also pleased to have contributed several language improvements.</p>
<h5 id="handler-cases-and-exceptional-syntax">Handler Cases and exceptional syntax</h5>
<p>OCaml’s <code>try</code> and <code>match</code> constructs are good at dealing with exceptions and values respectively, but neither constructs can handle both values and exceptions. Jeremy Yallop investigated <a href="http://ocamllabs.github.io/compiler-hacking/2014/02/04/handler-case.html#match-exception">how to handle success</a> more elegantly, and an elegant unified syntax emerged. A simple example is that of a stream iterator that uses exceptions for control flow:</p>
<pre><code>let rec iter_stream f s =
  match (try Some (MyStream.get s) with End_of_stream -&gt; None) with
  | None -&gt; ()
  | Some (x, s&#39;) -&gt; f x; iter_stream f s&#39;</code></pre>
<p>This code is not only verbose, but it also has to allocate an <code>option</code> value to ensure that the <code>iter_stream</code> calls remains tail recursive. The new syntax in OCaml 4.02 allows the above to be rewritten succinctly:</p>
<pre><code>let rec iter_stream f s =
  match MyStream.get s with
  | (x, s&#39;) -&gt; f x; iter_stream f s&#39;
  | exception End_of_stream -&gt; ()</code></pre>
<p>Read more about the background of this feature in Jeremy’s <a href="http://ocamllabs.github.io/compiler-hacking/2014/02/04/handler-case.html#match-exception">blog post</a>, the associated discussion in the <a href="http://caml.inria.fr/mantis/view.php?id=6318">upstream Mantis bug</a>, and the final <a href="http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec245">manual page</a> in the OCaml 4.02 release. For an example of its use in a real library, see the Jane Street <a href="https://github.com/janestreet/sexplib/blob/1bd69553/lib/conv.ml#L213-L215">usage</a> in the <a href="https://github.com/janestreet/sexplib">s-expression</a> handling library (which they use widely to reify arbitrary OCaml values and exceptions).</p>
<h5 id="open-extensible-types">Open Extensible Types</h5>
<p>A long-standing trick to build <a href="https://blogs.janestreet.com/rethinking-univ/">universal containers</a> in OCaml has been to encode them using the exception <code>exn</code> type. There is a similar concept of a <a href="http://mlton.org/UniversalType">universal type</a> in Standard ML, and they were described in the “<a href="http://www.andres-loeh.de/OpenDatatypes.pdf">Open Data Types and Open Functions</a>” paper by Andres Löh and Ralf Hinze in 2006.</p>
<p>Leo White designed, implemented and upstreamed support for <a href="http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec246">extensible variant types</a> in OCaml 4.02. Extensible variant types are variant types that can be extended with new variant constructors. They can be defined as follows:</p>
<pre><code>type attr = ..

type attr += Str of string

type attr +=
  | Int of int
  | Float of float</code></pre>
<p>Pattern matching on an extensible variant type requires a default case to handle unknown variant constructors, just as is required for pattern matching on exceptions (extensible types use the exception memory representation at runtime).</p>
<p>With this feature added, the OCaml <code>exn</code> type simply becomes a special case of open extensible types. Exception constructors can be declared using the type extension syntax:</p>
<pre><code>    type exn += Exc of int</code></pre>
<p>You can read more about the discussion behind open extensible types in the upstream <a href="http://caml.inria.fr/mantis/view.php?id=5584">Mantis bug</a>. If you’d like to see another example of their use, they have been adopted by the latest releases of the Jane Street Core libraries in the <a href="https://github.com/janestreet/core_kernel/blob/43ee3eef/lib/type_equal.ml#L64">Type_equal</a> module.</p>
<h4 id="modular-implicits">Modular Implicits</h4>
<iframe style="float:right; padding-left: 15px" width="200" height="150" src="https://www.youtube.com/embed/3wVUXTd4WNc?rel=0" frameborder="0" allowfullscreen="allowfullscreen">
</iframe>
<p>A common criticism of OCaml is its lack of support for ad-hoc polymorphism. The classic example of this is OCaml’s separate addition operators for integers (<code>+</code>) and floating-point numbers (<code>+.</code>). Another example is the need for type-specific printing functions (<code>print_int</code>, <code>print_string</code>, etc.) rather than a single <code>print</code> function which works across multiple types.</p>
<p>Taking inspiration from Scala’s <a href="http://docs.scala-lang.org/tutorials/tour/implicit-parameters.html">implicits</a> and <a href="http://www.mpi-sws.org/~dreyer/papers/mtc/main-long.pdf">Modular Type Classes</a> by Dreyer <em>et al.</em>, Leo White designed a system for ad-hoc polymorphism in OCaml based on using modules as type-directed implicit parameters. The design not only supports implicit modules, but also implicit functors (that is, modules parameterised by other module types) to permit the expression of generic modular implicits in exactly the same way that functors are used to build abstract data structures.</p>
<p>Frederic Bour joined us as a summer intern and dove straight into the implementation, resulting in an <a href="http://andrewray.github.io/iocamljs/modimp_show.html">online demo</a> and ML Workshop presentation (<a href="https://sites.google.com/site/mlworkshoppe/modular-implicits.pdf?attredirects=0">abstract</a>, <a href="https://www.youtube.com/watch?v=3wVUXTd4WNc">video</a> and <a href="http://www.lpw25.net/ml2014.pdf">paper</a>). Another innovation in how we’ve been trialling this feature is the use of Andy Ray’s <a href="https://andrewray.github.io/iocamljs/">IOCamlJS</a> to publish an interactive, online notebook that is fully hosted in the browser. You can follow the examples of modular implicits <a href="https://andrewray.github.io/iocamljs/modimp_show.html">online</a>, or try them out on your own computer via an OPAM switch:</p>
<pre><code>opam switch 4.02.0+modular-implicits
eval `opam config env`
opam install utop 
utop</code></pre>
<p>Some of the early feedback on modular implicits from industrial users was interesting. Jane Street commented that although this would be a big usability leap, it would be dangerous to lose control over exactly what goes into the implicit environment (i.e. the programmer should always know what <code>(a + b)</code> represents by locally reasoning about the code). The current design thus follows the ML discipline of maintaining explicit control over the namespace, with any ambiguities in resolving an implicit module type resulting in a type error.</p>
<h4 id="multicore">Multicore</h4>
<iframe style="float:right; padding-left:10px" width="200" height="150" src="https://www.youtube.com/embed/FzmQTC_X5R4?rel=0" frameborder="0" allowfullscreen="allowfullscreen">
</iframe>
<p>In addition to ad-hoc polymorphism, support for parallel execution on multicore CPUs is undoubtedly the most common feature request for OCaml. This has been high on our list after improving tooling support, and Stephen Dolan and Leo White made solid progress in 2014 on the core runtime plumbing required.</p>
<p>Stephen initially added <a href="https://github.com/stedolan/ocaml">thread-local support</a> to the OCaml compiler. This design avoided the need to make the entire OCaml runtime preemptive (and thus a huge patch) by allocating thread-local state per core.</p>
<p>We are now deep into the design and implementation of the programming abstractions built over these low-level primitives. One exciting aspect of our implementation is much of the scheduling logic for multicore OCaml can be written in (single-threaded) OCaml, making the design very flexible with respect to <a href="http://kcsrk.info/papers/mmscc_marc12.pdf">heterogenous hardware</a> and <a href="http://fable.io">variable IPC performance</a>.</p>
<p>To get feedback on the overall design of multicore OCaml, we presented at OCaml 2014 (<a href="http://www.cl.cam.ac.uk/~sd601/papers/multicore_slides.pdf">slides</a>, <a href="https://www.youtube.com/watch?v=FzmQTC_X5R4">video</a> and <a href="https://ocaml.org/meetings/ocaml/2014/ocaml2014_1.pdf">abstract</a>), and Stephen visited INRIA to consult with the development team and Arthur Chargueraud (the author of <a href="http://www.chargueraud.org/softs/pasl/">PASL</a>). Towards the end of the year, <a href="http://kcsrk.info/">KC Sivaramakrishnan</a> finished his PhD studies at Purdue and joined our OCaml Labs group. He is the author of <a href="http://multimlton.cs.purdue.edu/mML/Welcome.html">MultiMlton</a>, and is now driving the completion of the OCaml multicore work along with Stephen Dolan, Leo White and Mark Shinwell. Stay tuned for updates from us when there is more to show later this year!</p>
<h4 id="ctypes-a-modular-foreign-function-interface">Ctypes: a Modular Foreign Function Interface</h4>
<p><img src="graphics/ocl14rev/c.png" alt="OCaml Ctypes" class="floater" /> The <a href="https://github.com/ocamllabs/ocaml-ctypes">Ctypes</a> library started as an experiment with GADTs by Jeremy Yallop, and has since ballooned in a robust, comprehensive library for safely interacting with the OCaml foreign function interface. The first release came out in time to be included in <a href="https://realworldocaml.org/v1/en/html/foreign-function-interface.html">Real World OCaml</a> in lieu of the low-level FFI (which I was not particularly enamoured with having to explain in a tight page limit).</p>
<p>Throughout 2014, Jeremy expanded support for a number of features requested by users (both industrial and academic) who adopted the library in preference to manually writing C code to interface with the runtime, and issued several updated <a href="https://github.com/ocamllabs/ocaml-ctypes/releases">releases</a>.</p>
<h5 id="c-stub-generation">C Stub Generation</h5>
<p>The first release of Ctypes required the use of <a href="https://sourceware.org/libffi/">libffi</a> to dynamically load shared libraries and dynamically construct function call stack frames whenever a foreign function is called. While this works for simple libraries, it cannot cover <em>all</em> usecases, since interfacing with C demands an understanding of <code>struct</code> memory layout, C preprocessor macros, and other platform-dependent quirks which are more easily dealt with by invoking a C compiler. Finally, the performance of a <code>libffi</code>-based API will necessarily be slower than writing direct C stub code.</p>
<p>While many other language FFIs provide separate libraries for dynamic and static FFI libraries, we decided to have a go at building a <em>modular</em> version of Ctypes that could handle both cases from a single description of the foreign function interface. The result (dubbed “Cmeleon”) remained surprisingly succinct and usable, and now covers almost every use of the OCaml foreign function interface. We submitted a paper to <a href="http://icfpconference.org/2015">ICFP 2015</a> dubbed “<a href="http://anil.recoil.org/papers/drafts/2015-cmeleon-icfp-draft1.pdf">A modular foreign function interface</a>” that describes it in detail. Here is a highlight of how simple a generic binding looks:</p>
<pre><code>module Bindings(F : FOREIGN) = struct
  open F
  let gettimeofday = foreign &quot;gettimeofday&quot;
     (ptr timeval @-&gt; ptr timezone @-&gt; returning int)
end</code></pre>
<p>The <code>FOREIGN</code> module type completely abstracts the details of whether or not dynamic or static binding is used, and handles C complexities such as computing the struct layout on the local machine architecture.</p>
<h5 id="inverse-stubs">Inverse Stubs</h5>
<p>The other nice result from functorising the foreign function interface emerged when we tried to <em>invert</em> the FFI and serve a C interface from OCaml code (for example, by compiling the OCaml code as a <a href="http://caml.inria.fr/pub/docs/manual-ocaml/intfc.html">shared library</a>). This would let us begin swapping out C libraries that we <a href="http://openssl.org">don’t trust</a> with <a href="https://github.com/mirage/ocaml-tls">safer equivalents</a> written in OCaml.</p>
<p>You can see an <a href="https://github.com/yallop/ocaml-ctypes-inverted-stubs-example">example</a> of how inverted stubs work via a simple C XML parsing exposed from the <a href="http://erratique.ch/software/xmlm">Xmlm</a> library. We can define a C <code>struct</code> by:</p>
<pre><code>(* Define a struct of callbacks (C function pointers) *)
let handlers : [`handlers] structure typ = structure &quot;handlers&quot;
let (--) s f = field handlers s (funptr f)
 let on_data      = &quot;on_data&quot;      -- (string @-&gt; returning void)
 let on_start_tag = &quot;on_start_tag&quot; -- (string @-&gt; string @-&gt; returning void)
 let on_end_tag   = &quot;on_end_tag&quot;   -- (void @-&gt; returning void)
 let on_dtd       = &quot;on_dtd&quot;       -- (string @-&gt; returning void) 
 let on_error     = &quot;on_error&quot;     -- (int @-&gt; int @-&gt; string @-&gt; returning void)
let () = seal handlers</code></pre>
<p>and then expose this via C functions:</p>
<pre><code>module Stubs(I : Cstubs_inverted.INTERNAL) = struct
  (* Expose the type &#39;struct handlers&#39; to C. *)
  let () = I.structure handlers

  (* We expose just a single function to C.  The first argument is a (pointer
     to a) struct of callbacks, and the second argument is a string
     representing a filename to parse. *)
  let () = I.internal &quot;parse_xml&quot; 
     (ptr handlers @-&gt; string @-&gt; returning void) parse
end</code></pre>
<p>You can find the full source code to these snippets on the <a href="https://github.com/yallop/ocaml-ctypes-inverted-stubs-example">ocaml-ctypes-inverted-stubs-example</a> repository on GitHub.</p>
<p>We’ll be exploring this aspect of Ctypes further in 2015 for SSL/TLS with David Kaloper and Hannes Mehnert, and Microsoft Research has generously funded a <a href="http://research.microsoft.com/en-us/collaboration/global/phd_projects2015.aspx">PhD studentship</a> to facilitate the work.</p>
<h5 id="community-contributions">Community Contributions</h5>
<p>Ctypes benefited enormously from several external contributions from the OCaml community. From a portability perspective, A. Hauptmann contributed <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/190">Windows support</a>, and Thomas Leonard added <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/231">Xen support</a> to allow Ctypes bindings to work with <a href="http://openmirage.org">MirageOS unikernels</a> (which opens up the intriguing possibility of accessing shared libraries across virtual machine boundaries in the future). C language support was fleshed out by Edwin Torok contributing <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/238">typedef support</a>, Ramkumar Ramachandra adding <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/220">C99 bools</a> and Peter Zotov integrating <a href="https://github.com/ocamllabs/ocaml-ctypes/pull/143">native strings</a>.</p>
<p>The winner of “most enthusiastic use of OCaml Labs code” goes to <a href="https://github.com/braibant">Thomas Braibant</a> of <a href="http://cryptosense.com/the-team/">Cryptosense</a>, who used <em>every</em> feature of the Ctypes library (consider multi-threaded, inverted, staged and marshalled bindings) in their effort to <a href="http://www.economist.com/news/science-and-technology/21647269-automating-search-loopholes-software-hacking-hackers">hack the hackers</a>. David Sheets comes a close second with his implementation of the <a href="https://github.com/dsheets/profuse">FUSE binary protocol</a>, parameterised by version quirks.</p>
<p>If you’re using Ctypes, we would love to hear about your particular use. A search on GitHub and OPAM reveals over 20 projects using it already, including industrial use at <a href="http://cryptosense.com">Cryptosense</a> and <a href="http://ocaml.janestreet.com">Jane Street</a>, and ports to Windows, *BSD, MacOS X and even iPhone and Android. There’s a <a href="https://github.com/ocamllabs/ocaml-ctypes/wiki">getting started</a> guide, and a <a href="http://lists.ocaml.org/listinfo/ctypes">mailing list</a> available.</p>
<h3 id="community-and-teaching-efforts">Community and Teaching Efforts</h3>
<p>In addition to the online community building, we also participated in a number of conferences and face-to-face events to promote education about functional programming.</p>
<h4 id="conferences-and-talks"> Conferences and Talks</h4>
<p><img src="graphics/ocl14rev/qcon-unikernel-talk.jpg" alt="QCon unikernel talk" class="floater" /> There has been a huge growth in the number of quality conferences in recent years, making it tough to choose which ones to attend. <a href="http://icfpconference.org">ICFP</a> is the academic meeting point that predates most of them, and we <a href="http://anil.recoil.org/2014/08/31/ocaml-labs-at-icfp-2014.html">participated extensively</a> in 2014 via talks, tutorials and a <a href="https://www.youtube.com/watch?v=UEIHfXLMtwA">keynote</a> at the Haskell Symposium.<br />
I also served on the <a href="http://icfpconference.org/icfp2014/">program committee</a> and <a href="http://anil.recoil.org/2015/02/18/icfp15-call-for-sponsorships.html">industrial relations chair</a> and took over as the steering committee chair of <a href="http://cufp.org">CUFP</a>. Jeremy Yallop, Thomas Gazagnaire and Leo White all served program committees on workshops, with Jeremy also chairing this year’s ML Workshop.</p>
<p>Outside of academic conferences, we participated in a number of non-academic conferences such as <a href="https://qconsf.com/">QCon</a>, <a href="http://oscon.com">OSCON</a>, <a href="http://ccc.de">CCC</a>, <a href="https://operatingsystems.io/">New Directions in OS</a>, <a href="http://functionalconf.com">FunctionalConf</a>, <a href="https://skillsmatter.com/conferences/1819-functional-programming-exchange">FPX</a> and <a href="https://fosdem.org/2014/">FOSDEM</a>. The vast majority of these talks were about the MirageOS, and slides can be found at <a href="http://decks.openmirage.org">decks.openmirage.org</a>.</p>
<h5 id="the-2048-browser-game">The 2048 Browser Game</h5>
<p>Yaron Minsky and I have run OCaml tutorials for ICFP for <a href="http://cufp.org/2011/t3-building-functional-os.html">a</a> <a href="http://cufp.org/2013/t2-yaron-minsky-anil-madhavapeddy-ocaml-tutorial.html">few</a> <a href="http://cufp.org/2012/t1-real-world-ocaml-anil-madhavapeddy-university-c.html">years</a>, and we finally hung up our boots in favour of a new crowd.</p>
<p>Jeremy Yallop and Leo White stepped up to the mark with their ICFP/CUFP 2014 <a href="http://cufp.org/2014/t7-leo-white-introduction-to-ocaml.html">Introduction to OCaml</a> tutorial, which had the additional twist of being taught entirely in a web browser by virtue of using the <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a> and <a href="http://andrewray.github.io/iocamljs/">IOCamlJS</a>. They decided that a good practical target was the popular <a href="http://gabrielecirulli.github.io/2048/">2048</a> game that has wasted many programmer hours here at OCaml Labs. They <a href="https://github.com/ocamllabs/2048-tutorial">hacked on it</a> over the summertime, assisted by our visitor Daniel Buenzli who also released useful libraries such as <a href="http://erratique.ch/software/vg">Vg</a>, <a href="http://erratique.ch/software/react">React</a>, <a href="http://erratique.ch/software/useri">Useri</a>, and <a href="http://erratique.ch/software/gg">Gg</a>.</p>
<p>The end result is satisfyingly <a href="http://ocamllabs.github.io/2048-tutorial/">playable online</a>, with the source code available at <a href="https://github.com/ocamllabs/2048-tutorial">ocamllabs/2048-tutorial</a>.</p>
<p>Thomas Gazagnaire got invited to Bangalore for <a href="http://functionalconf.com/">Functional Conf</a> later in the year, and he extended the <a href="http://gazagnaire.org/fuconf14/">interactive tutorial notebook</a> and also ran an OCaml tutorial to a packed room. We were very happy to support the first functional programming conference in India, and hope to see many more such events spring up! Amir Chaudhry then went to Belgium to <a href="https://fosdem.org/2015/">FOSDEM 2015</a> where he showed off <a href="http://amirchaudhry.com/unikernel-arm-demo-fosdem/">the 2048 game running as an ARM unikernel</a> to a crowd of attendees at the Xen booth.</p>
<h4 id="graduate-teaching">Graduate Teaching</h4>
<p><img src="graphics/ocl14rev/l23-thumb.jpg" alt="Graduate Teaching" class="floater" /> Jeremy Yallop and Leo White (with assistance from Alan Mycroft and myself) also led the design of a new graduate course on <a href="http://www.cl.cam.ac.uk/teaching/1415/L28/">Advanced Functional Programming</a> at the Computer Laboratory. This ran in the <a href="http://en.wikipedia.org/wiki/Lent_term">Lent Term</a> and was over-subscribed by three times the number who pre-registered (due to a number of PhD students and our collaborators from <a href="http://citrix.com">Citrix</a> also attending).</p>
<p>The course materials are <a href="http://www.cl.cam.ac.uk/teaching/1415/L28/materials.html">freely available online</a> and cover the theory behind functional programming, and then move onto type inference, abstraction and parametricity, GADTs, rows, monads, and staging. We will be running this again in future years, and the lecture materials are already proving useful to <a href="https://sympa.inria.fr/sympa/arc/caml-list/2015-04/msg00001.html">answer mailing list questions</a>.</p>
<h4 id="mentoring-beginners">Mentoring Beginners</h4>
<p>We also had the pleasure of mentoring up-and-coming functional programmers via several outreach programs, both face-to-face and remote.</p>
<h5 id="cambridge-compiler-hacking">Cambridge Compiler Hacking</h5>
<p><img src="graphics/ocl14rev/compiler-hacking-dsyme-thumb.jpg" alt="Compiler Hacking" class="floater" /> We started the <a href="http://ocamllabs.github.io/compiler-hacking/">Cambridge Compiler Hacking</a> sessions in a small way towards the end of 2013 in order to provide a local, friendly place to assist people who wanted to dip their toes into the unnecessarily mysterious world of programming language hacking. The plan was simple: provide drinks, pizza, network and a <a href="https://github.com/ocamllabs/compiler-hacking/wiki">bug list of varying difficulty</a> for attendees to choose from and work on for the evening, with mentoring from the experienced OCaml contributors.</p>
<p>We continued this bi-monthly tradition in 2014, with a regular attendance of 15-30 people, and even cross-pollinated communities with our local F# and Haskell colleagues. We rotated locations from the Cambridge Computer Laboratory to Citrix, Makespace, and the new Cambridge Postdoc Centre. We posted some <a href="http://ocamllabs.github.io/compiler-hacking/2014/06/24/highlights-from-recent-sessions.html">highlights</a> from sessions towards the start of the year, and are very happy with how it’s going. There has even been uptake of the bug list across the water in France, thanks to Gabriel Scherer.</p>
<p>In 2015, we’d like to branch out further and host some sessions in London. If you have a suggestion for a venue or theme, please <a href="http://lists.ocaml.org/listinfo/cam-compiler-hacking">get in touch</a>!</p>
<h5 id="summer-programs">Summer Programs</h5>
<p>There has been a laudable rise in summer programs designed to encourage diversity in our community, and we of course leap at the opportunity to participate in these when we find them.</p>
<ul>
<li>The <a href="https://gnome.org/opw/">GNOME Outreach Program</a> (now also known as <a href="https://www.gnome.org/outreachy/">Outreachy</a>) had one funded place for Xen and MirageOS. <a href="http://www.somerandomidiot.com/">Mindy Preston</a> did a spectacular <a href="http://www.somerandomidiot.com/blog/categories/ocaml/">blog series</a> about her experiences and motivations behind learning OCaml.</li>
<li>The <a href="https://www.google-melange.com/">Google Summer of Code 2014</a> also had us <a href="http://openmirage.org/blog/applying-for-gsoc2014">participating</a> via MirageOS, and <a href="https://github.com/moonlightdrive">Jyotsna Prakash</a> took on the challenging job of building OCaml bindings for Amazon EC2, also detailed on <a href="https://1000hippos.wordpress.com/">her blog</a>.</li>
<li>Amir Chaudhry began the <a href="https://github.com/mirage/mirage-www/wiki/Pioneer-Projects">Mirage Pioneer Projects</a> initiative to give beginners an easier onramp, and this has taken off very effectively as a way to advertise interesting projects for beginners at varying levels of difficulties.</li>
</ul>
<p>Our own students also had the chance to participate in such workshops to get out of Cambridge in the summer! <a href="http://hh360.user.srcf.net/blog/">Heidi Howard</a> liveblogged her experiences at the <a href="http://www.syslog.cl.cam.ac.uk/2015/01/14/programming-languages-mentoring-workshop-plmw/">PLMW</a> workshop in Mumbai. Meanwhile, <a href="https://github.com/dsheets">David Sheets</a> got to travel to the slightly less exotic London to <a href="http://www.syslog.cl.cam.ac.uk/2014/11/25/new-directions-in-operating-systems/">liveblog OSIO</a>, and Leonhard Markert covered <a href="http://www.syslog.cl.cam.ac.uk/2014/09/05/ocaml-2014/">ICFP 2014</a> as a student volunteer.</p>
<h4 id="blogging-and-online-activities">Blogging and Online Activities</h4>
<p><img src="graphics/ocl14rev/jeremy-rwo-thumb.jpg" alt="Blogging" class="floater" /> Our <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/blogs/">blog roll</a> maintains the ongoing stream of activity from the OCaml Labs crew, but there were some particular highlights throughout 2014.</p>
<ul>
<li><a href="http://roscidus.com/blog/">Thomas Leonard</a> began writing about his experiences with switching his <a href="http://0install.net">0install</a> installation system from <a href="http://roscidus.com/blog/blog/2014/06/06/python-to-ocaml-retrospective/">Python to OCaml</a> and <a href="http://roscidus.com/blog/blog/2014/02/13/ocaml-what-you-gain/">what you gain with OCaml</a>. This series led to a bunch of interesting feedback on social networking sites, and Thomas joined the group full-time to work on our research into <a href="http://roscidus.com/blog/blog/2015/01/21/securing-the-unikernel/">unikernels</a>.</li>
<li><a href="http://www.skjegstad.com/">Magnus Skjegstad</a> returned from Norway to Cambridge to work on MirageOS, and came up with some <a href="http://www.skjegstad.com/blog/2015/03/25/mirageos-vm-per-url-experiment/">crazy experiements</a>, as well as helping to build <a href="http://www.skjegstad.com/blog/2015/01/19/mirageos-xen-virtualbox/">Vagrant images</a> of the OCaml development environment.</li>
<li><a href="http://amirchaudhry.com">Amir Chaudhry</a> began his quest to <a href="http://amirchaudhry.com/writing-planet-in-pure-ocaml/">port his website</a> website to a <a href="http://amirchaudhry.com/from-jekyll-to-unikernel-in-fifty-lines/">Jekyll unikernel</a>.</li>
<li>The <a href="http://openmirage.org/blog/announcing-mirage-20-release">Mirage 2.0 release</a> in the summer of 2014 saw a slew of blogs posts about the <a href="http://openmirage.org/blog/2014-in-review">surge</a> in MirageOS activity.</li>
</ul>
<p>It wasn’t all just blogging though, and Jeremy Yallop and Leo White in particular participated in some epic OCaml <a href="http://caml.inria.fr/mantis/view.php?id=5528">bug threads</a> about new features, and <a href="https://sympa.inria.fr/sympa/arc/caml-list/2015-02/msg00150.html">explanations</a> about OCaml semantics on the mailing list.</p>
<p>Amir Chaudhry also continued to curate and develop the content on the <a href="http://ocaml.org">ocaml.org</a> website with our external collaborators <a href="">Ashish Agarwal</a>, <a href="">Christophe Troestler</a> and <a href="">Phillippe Wang</a>. Notably, it is now the recommended site for OCaml (with the <a href="http://caml.inria.fr">INRIA site</a> being infrequently updated), and also hosts the <a href="https://ocaml.org/meetings/">ACM OCaml Workshop</a> pages. One addition that highlighted the userbase of OCaml in the teaching community came from building a <a href="https://ocaml.org/learn/teaching-ocaml.html">map of all of the universities</a> where the language is taught, and this was Yan Shvartzshnaider’s <a href="http://yansnotes.blogspot.co.uk/2014/11/good-news-everyone-ocamlorg-teaching.html">first contribution</a> to the site.</p>
<h4 id="visitors-and-interns">Visitors and Interns</h4>
<p><img src="graphics/ocl14rev/ocl-pub.jpg" alt="Visitors" class="floater" /> Finally, a really important part of any community is hanging out with each other to chat over ideas in a friendly environment. As usual, we had a very steady stream of visitors and interns throughout 2014 to facilitate this.</p>
<p>Frederic Bour, Benjamin Farinier and Matthieu Journault joined us as summer interns from their respective universities in France as part of their Masters programs. Frederic worked on modular implicits and <a href="https://www.irill.org/videos/oups-december-2014/Modular_implicits">gave a great talk</a> at the OCaml Users group. Benjamin and Matthieu worked on Irmin data structures and complexity (and <a href="https://github.com/mirage/merge-queues">merge-queues</a> and <a href="https://github.com/mirage/merge-ropes">merge-ropes</a>), and Benjamin had his paper on “<a href="http://anil.recoil.org/papers/2015-jfla-irmin.pdf">Mergeable Persistent Data Structures</a>” accepted to <a href="http://jfla.inria.fr/2015/">JFLA 2015</a>, while Matthieu’s work on efficient algorithms for synchronising Irmin DAGs is being integrated into the upstream source code.</p>
<p>Daniel Buenzli repeated his visit from 2013 and spent a productive summer with us, commenting on almost every project we’re working on. In his own words (edited for brevity):</p>
<blockquote>
<p>I started by implementing and releasing <a href="http://erratique.ch/software/uucp">Uucp</a>, a library to provide efficient access to a selection of the properties of the latest Unicode Character database (UCD). […] As a side effect of the previous point I took time to write an absolute <a href="http://erratique.ch/software/uucp/doc/Uucp.html#uminimal">minimal introduction to Unicode</a>. […] Since I was in this Unicode business I took the opportunity to propose a <a href="https://github.com/ocaml/ocaml/pull/80">31 loc patch to the standard library</a> for a type to represent Unicode scalar values (an Unicode character to be imprecise) to improve interoperability.</p>
<p>The usual yearly update to OpenGL was announced at the Siggraph conference. This prompted me to update the ctypes-based <a href="http://erratique.ch/software/tgls">tgls library</a> for supporting the latest entry point of OpenGL 4.5 and OpenGL ES 3.1. Since the bindings are automatically generated from the OpenGL XML registry the work is not too involved but there’s always the odd function signature you don’t/can’t handle automatically yet.</p>
<p>Spend quite a bit (too much) time on <a href="http://erratique.ch/software/useri">useri</a>, a small multi-platform abstraction for setting up a drawing surface and gather user input (<em>not</em> usury) as <a href="http://erratique.ch/software/react">React</a> events. Useri started this winter as a layer on top of SDL to implement a <a href="http://erratique.ch/log/2014-05-18">CT scan app</a> and it felt like this could be the basis for adding interactivity and animation to Vg/Vz visualizations – js viz libraries simply rely on the support provided by the browser or SVG support but Vg/Vz strives for backend independence and clear separations of concern (up to which limit remains an open question). Unfortunately I couldn’t bring it to a release and got a little bit lost in browser compatibility issues and trying to reconcile what browser and SDL give us in terms of functionality and way of operating, so that a maximum of client code can be shared among the supported platforms. But despite this non-release it still managed to be useful in some way, see the next point.</p>
<p>Helped Jeremy and Leo to implement the rendering and interaction for their ICFP tutorial <a href="https://github.com/ocamllabs/2048-tutorial">2048 js_of_ocaml implementation</a>. This featured the use of Gg, Vg, Useri and React and I was quite pleased with the result (despite some performance problems in certain browsers, but hey composable rendering and animation without a single assignement in client code). It’s nice to see that all these pains at trying to design good APIs eventually fit together […]</p>
</blockquote>
<p>A couple of visitors joined us from sunny <a href="http://github.com/mirleft">Morocco</a>, where Hannes Mehnert and David Kaloper had gone to work on a clean-slate TLS stack. They found the <a href="http://openmirage.org">MirageOS</a> effort online, and got in touch about visiting. After a very fun summer of hacking, their stack is now the standard TLS option in MirageOS and resulted in the <a href="http://amirchaudhry.com/bitcoin-pinata/">Bitcoin Pinata challenge</a> being issued! Hannes and David have since moved to Cambridge to work on this stack full-time in 2015, but the internships served as a great way for everyone to get to know each other.</p>
<p><img src="graphics/ocl14rev/christs-dinner.jpg" alt="Dinner at Christs College" class="floater" />&gt; We also had the pleasure of visits from several of our usually remote collaborators. <a href="https://github.com/Chris00">Christophe Troestler</a>, <a href="http://ocaml.janestreet.com">Yaron Minsky</a>, <a href="http://github.com/diml">Jeremie Diminio</a> and <a href="https://github.com/andrewray">Andy Ray</a> all visited for the annual OCaml Labs <a href="https://gist.github.com/avsm/18450004ae19c2facf7a">review meeting</a> in Christ’s College. There were also many academic talks from foreign visitors in our <a href="http://talks.cam.ac.uk/show/archive/8316">SRG seminar series</a>, ranging from <a href="http://www.cse.iitb.ac.in/~uday/">Uday Khedkar</a> from IIT to <a href="http://okmij.org/ftp/">Oleg Kiselyov</a> deliver multiple talks on staging and optimisation (as well as making a celebrity appearance at the compiler hacking session, and <a href="http://ocaml.janestreet.com">Yaron Minsky</a> delivering an Emacs-driven departmental seminar on his experiences with <a href="http://talks.cam.ac.uk/talk/index/51144">Incremental</a> computation.</p>
<h3 id="research-efforts">Research Efforts</h3>
<p>The OCaml Labs are of course based in the Cambridge Computer Laboratory, where our day job is to do academic research. Balancing the demands of open source coding, community efforts and top-tier research has be a tricky one, but an effort that has been worthwhile.</p>
<p><img src="graphics/ocl14rev/nsdi-deadline.jpg" alt="Research" class="floater" /> Our research efforts are broadly unchanged <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/news/index.html#Dec%202013">from 2013</a> (it takes time to craft good ideas!), and this will not be an exhaustive recap. Instead, we’ll summarise them here and point to our <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/papers/index.html">papers</a> that describe the work in detail.</p>
<ul>
<li><p>The <a href="http://openmirage.org">MirageOS</a> really found its own feet in 2014, with a <a href="http://openmirage.org/blog/announcing-mirage-20-release">summer 2.0 release</a> and an extensive <a href="http://openmirage.org/blog/2014-in-review">end-of-year recap</a>. The most notable thing has been how well the MirageOS research work has melded with the core OCaml Labs efforts, since much of it has been constructing good quality OCaml libraries to plug holes in the ecosystem. It also served to make us use OPAM on a day-to-day basis for our own work, thus creating an effective feedback loop between open-source and research.</p></li>
<li><p>In the <a href="http://trilogy2.it.uc3m.es/">Trilogy2</a> and <a href="http://usercentricnetworking.eu/">UCN</a> EU projects, we built out MirageOS features such as the <a href="http://anil.recoil.org/papers/2015-nsdi-jitsu.pdf">Jitsu</a> toolstack for the “just-in-time” summoning of unikernels in response to DNS requests. This paper will be presented next month at UlSENIX <a href="https://www.usenix.org/conference/nsdi15/">NSDI</a>. It also drove the development of the <a href="http://openmirage.org/blog/introducing-xen-minios-arm">ARMv7 port</a>, an architecture for which OCaml has an excellent native code generator, as well as more experimental forays into <a href="http://arxiv.org/abs/1412.4638">BitCoin incentive schemes</a> for distributed systems.</p></li>
</ul>
<iframe style="float:right; padding-left: 15px" width="200" height="150" src="https://www.youtube.com/embed/DSzvFwIVm5s?rel=0" frameborder="0" allowfullscreen="allowfullscreen">
</iframe>
<ul>
<li><p>The <a href="http://irmin.io">Irmin</a> Git-like branchable store created by Thomas Gazagnaire matured, with Dave Scott <a href="https://www.youtube.com/watch?v=DSzvFwIVm5s">prototyping</a> a complex port of the <a href="http://wiki.xen.org/wiki/XenStore">XenStore</a> database to Irmin, thus letting us show off <a href="http://decks.openmirage.org/xendevsummit14#/">debugging systems with Git</a>. We had a paper accepted on some early datastructures accepted at <a href="http://anil.recoil.org/papers/2015-jfla-irmin.pdf">JFLA</a>, and Thomas Leonard is building the JavaScript backend for running in-browser, while Yan Schvartzshnaider is experimenting with <a href="http://yansnotes.blogspot.co.uk/2015/01/work-summary-ocaml-labs.html">graph processing</a> over the DAG representation for privacy-friendly queries. KC is investigating how to adapt his PLDI 2015 paper on <a href="http://kcsrk.info/papers/quelea_pldi15.pdf">Quelea</a> into using Irmin as a backend as well.</p></li>
<li><p>The <a href="https://github.com/ocamllabs/higher">Higher</a> kinded polymorphism library written by Jeremy Yallop and Leo White was published in <a href="http://www.lpw25.net/flops2014.pdf">FLOPS 2014</a>, forming a basis for building more complex use-cases that need the flexibility of higher kinded types without requiring functorising code.</p></li>
</ul>
<p><img src="graphics/ocl14rev/scotty.jpg" alt="Dave Scott and Google Glass" class="floater" /> Our long standing research into <a href="http://nymote.org">personal online privacy</a> led to our next system target that uses unikernels: the <a href="http://arxiv.org/abs/1501.04737">Databox</a> paper outlines the architecture, and was covered in the <a href="http://www.theguardian.com/technology/2015/feb/01/control-personal-data-databox-end-user-agreement">Guardian</a> newspaper. Jon Crowcroft led the establishment of the Cambridge wing of the <a href="http://www.mccrc.eu/about-us">Microsoft Cloud Computing Research Center</a> to consider the legal aspect of things, and so we have made forays outside of technology into considering the implications of <a href="http://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-863.pdf">region-specific clouds</a> as well.</p>
<p>Some of the most exciting work done in the group as part of the <a href="http://rems.io">REMS</a> and <a href="http://www.naas-project.org/">NaaS</a> projects came towards the end of 2014 and start of 2015, with multiple submissions going into top conferences. Unfortunately, due to most of them being double blind reviewed, we cannot link to the papers yet. Keep an eye on the blog and <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/papers/index.html">published paper set</a>, or ask us directly about what’s been going on!</p>
<h3 id="priorities-for-2015">Priorities for 2015</h3>
<p>As spring breaks and the weather (almost) becomes bearable again, we’re setting our work priorities for the remainder of the year.</p>
<ul>
<li><p><strong>Tooling Cohesion</strong>: The entire core team is focussed on fusing together the individual tools that have been created last year into a cohesive OCaml Platform release that covers the lifecycle of documentation, testing and build. This is being managed by Amir Chaudhry. OPAM remains at the heart of this strategy, and Louis Gesbert and Thomas Gazagnaire have settled on the <a href="https://github.com/ocaml/opam/wiki/1.3-Roadmap">OPAM 1.3 roadmap</a> (<a href="http://lists.ocaml.org/pipermail/opam-devel/2015-February/000940.html">summary</a>).</p></li>
<li><p><strong>Multicore</strong>: <a href="kcsrk.info">KC Sivaramakrishnan</a> has joined the core OCaml Labs fulltime to drive the multicore work into a publically testable form. Leo White recently departed after many productive years in Cambridge to head into a career in industry (but still remains very much involved with OCaml development!).</p></li>
<li><p><strong>Language Evolution</strong>: Jeremy Yallop continues to drive our efforts on staged programming, modular implicits, and a macro system for OCaml, all of which are key features that make building complex, reliable systems more tractable than ever.</p></li>
</ul>
<p>I’d like to thank the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/index.html">entire team</a> and wider community for a wonderfully enjoyable 2014 and start of 2015, and am very thankful to the funding and support from Jane Street, Citrix, British Telecom, RCUK, EPSRC, DARPA and the EU FP7 that made it all possible. As always, please feel free to contact any of us directly with questions, or reach out to me <script type="text/javascript">
<!--
h='&#x63;&#108;&#46;&#x63;&#x61;&#x6d;&#46;&#x61;&#x63;&#46;&#x75;&#x6b;';a='&#64;';n='&#x61;&#118;&#x73;&#x6d;&#50;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+'&#112;&#x65;&#114;&#x73;&#x6f;&#110;&#x61;&#108;&#108;&#x79;'+'<\/'+'a'+'>');
// -->
</script><noscript>&#112;&#x65;&#114;&#x73;&#x6f;&#110;&#x61;&#108;&#108;&#x79;&#32;&#40;&#x61;&#118;&#x73;&#x6d;&#50;&#32;&#x61;&#116;&#32;&#x63;&#108;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x61;&#x6d;&#32;&#100;&#x6f;&#116;&#32;&#x61;&#x63;&#32;&#100;&#x6f;&#116;&#32;&#x75;&#x6b;&#x29;</noscript> with any queries, concerns or bars of chocolate as encouragement.</p>
<h2 id="in-review-1">2013 in Review</h2>
<p><a href="graphics/ocl13rev/lab_main.jpg" class="floater">2013 review</a> This time last year in 2012, I had just <a href="http://anil.recoil.org/2012/10/19/announcing-ocaml-labs.html">announced</a> the formation of a new group called <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/">OCaml Labs</a> in the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Lab</a> that would combine research and community work towards the practical application of functional programming. An incredible year has absolutely flown by, and I’ve put together this post to summarise what’s gone on, and point to our future directions for 2014.</p>
<p>The theme of our group was not to be pure research, but rather a hybrid group that would take on some of the load of day-to-day OCaml maintenance from <a href="http://caml.inria.fr">INRIA</a>, as well as help grow the wider OCaml community. To this end, all of our projects have been highly collaborative, often involving colleagues from <a href="http://ocamlpro.com">OCamlPro</a>, <a href="http://gallium.inria.fr/">INRIA</a>, <a href="http://janestreet.com">Jane Street</a>, <a href="http://www.lexifi.com/">Lexifi</a> and <a href="http://citrix.com">Citrix</a>.</p>
<p>This post covers progress in <a href="#tooling">tooling</a>, the <a href="#core_compiler">compiler and language</a>, <a href="#community_efforts">community efforts</a>, <a href="#research_projects">research projects</a> and concludes with our <a href="#priorities_for_2014">priorities for 2014</a>.</p>
<h3 id="tooling-1">Tooling</h3>
<p>At the start of 2013, OCaml was in the interesting position of being a mature decades-old language with a small, loyal community of industrial users who built mission critical applications using it. We had the opportunity to sit down with many of them at the <a href="http://caml.inria.fr/consortium/">OCaml Consortium</a> meeting and prioritise where we started work. The answer came back clearly: while the compiler itself is legendary for its stability, the tooling around it (such as package management) was a pressing problem.</p>
<h4 id="opam-1">OPAM</h4>
<p>Our solution to this tooling was centered around the <a href="http://opam.ocaml.org">OPAM</a> package manager that <a href="http://ocamlpro.com">OCamlPro</a> released into beta just at the end of 2012, and had its first stable release in March 2013. OPAM differs from most system package managers by emphasising a flexible distributed workflow that uses version constraints to ensure incompatible libraries aren’t mixed up (important for the statically-typed OCaml that is very careful about dependencies). Working closely with <a href="http://ocamlpro.com">OCamlPro</a> we developed a git-based workflow to make it possible for users (both individual or industrial) to easily build up their own package repositories and redistribute OCaml code, and started curating the <a href="https://github.com/ocaml/opam-repository">package repository</a>.</p>
<p>The results have been satisfying: we started with an initial set of around 100 packages in OPAM (mostly imported by the 4 developers), and ended 2013 with 587 unique packages and 2000 individual versions, with contributions from 160 individuals. We now have a curated <a href="https://github.com/ocaml/opam-repository">central package repository</a> for anyone to submit their OCaml code, several third-party remotes are maintained (e.g. the <a href="https://github.com/xapi-project/opam-repo-dev">Xen Project</a> and <a href="https://github.com/ocsigen/opam-ocsigen">Ocsigen</a>). We also regularly receive releases of the <a href="http://ocaml.janestreet.com">Core</a> libraries from Jane Street, and updates from sources as varied as <a href="https://github.com/ocaml/opam-repository/pull/1300">Facebook</a>, <a href="http://anil.recoil.org/2013/09/16/camlpdf-the-end-of-sucky-pdf-tools.html">Coherent PDF</a>, to the <a href="http://ocaml.org/meetings/ocaml/2013/slides/guha.pdf">Frenetic SDN</a> research.</p>
<div class="figure">
<img src="graphics/ocl13rev/opam11-contributors-dec13.png" alt="Number of unique contributors to the central OPAM package repository" />
<p class="caption">Number of unique contributors to the central OPAM package repository</p>
</div>
<div class="figure">
<img src="graphics/ocl13rev/opam11-packages-dec13.png" alt="Total number of unique packages (including multiple versions of the same package)" />
<p class="caption">Total number of unique packages (including multiple versions of the same package)</p>
</div>
<div class="figure">
<img src="graphics/ocl13rev/opam11-unique-packages-dec13.png" alt="Total packages with multiple versions coalesced so you can see new package growth" />
<p class="caption">Total packages with multiple versions coalesced so you can see new package growth</p>
</div>
<p>A notable contribution from OCamlPro during this time was to <a href="https://github.com/ocaml/opam-repository/issues/955">clarify</a> the licensing on the package repository to be the liberal <a href="http://creativecommons.org/choose/zero/">CC0</a>, and also to pass ownership to the <a href="http://github.com/ocaml">OCaml</a> organization on GitHub, where it’s now jointly maintained by OCaml Labs, OCamlPro and anyone else that wishes to contribute.</p>
<h4 id="a-lens-into-global-ocaml-code">A lens into global OCaml code</h4>
<p>It’s been quite interesting just watching all the varied code fly into the repository, but stability quickly became a concern as the new packages piled up. OCaml compiles to native code on not just x86, but also PowerPC, Sparc and <a href="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml.html">ARM</a> CPUs. We kicked off various efforts into automated testing: firstly <a href="https://github.com/dsheets">David Sheets</a> built the <a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging.html">OCamlot</a> daemon that would schedule builds across all the exotic hardware. Later in the year, the <a href="http://travis-ci.org">Travis</a> service launched support for testing from GitHub pull requests, and this became the front line of <a href="http://anil.recoil.org/2013/09/30/travis-and-ocaml.html">automated checking</a> for all incoming new packages to OPAM.</p>
<p>A major headache with automated testing is usually setting up the right build environment with external library dependencies, and so we <a href="http://anil.recoil.org/2013/11/15/docker-and-opam.html">added Docker support</a> to make it easier to bulk-build packages for local developer use, with the results of builds available <a href="https://github.com/avsm/opam-bulk-logs">publically</a> for anyone to help triage. Unfortunately fixing the bugs themselves is still a <a href="https://github.com/ocaml/opam-repository/issues/1304">very manual process</a>, so more volunteers are always welcome to help out!</p>
<p><img src="graphics/travis-mascot-200px.png" alt="Travis CI" class="floater" /> We’re going to be really seeing the rewards from all this effort as OCaml 4.02 development proceeds, since we can now adopt a data-driven approach to changing language features instead of guessing how much third-party code will break. If your code is in OPAM, then it’ll be tested as new features such as <a href="http://caml.inria.fr/mantis/view.php?id=6063">module aliases</a>, <a href="http://ocaml.org/meetings/ocaml/2013/slides/garrigue.pdf">injectivity</a> and <a href="http://ocaml.org/meetings/ocaml/2013/slides/white.pdf">extension points</a> show up.</p>
<h4 id="better-documentation">Better documentation</h4>
<p>The venerable <a href="http://caml.inria.fr/pub/docs/manual-ocaml-4.00/manual029.html">OCamlDoc</a> tool has done an admirable job for the last decade, but is increasingly showing its age due to a lack of support for cross-referencing across packages. We started working on this problem in the summer when <a href="https://github.com/vincent-botbol">Vincent Botbol</a> visited us on an internship, expecting it to be a quick job to come up with something as good as Haskell’s excellent <a href="http://www.haskell.org/haddock/">Haddock</a> online documentation.</p>
<p>Instead, we ran into the “module wall”: since OCaml makes it so easy to parameterise code over other modules, it makes it hard to generate static documentation without outputting hundreds of megabytes of HTML every time. After some hard work from Vincent and Leo, we’ve got a working prototype that lets you simply run <code>opam install opam-doc &amp;&amp; opam doc core async</code> to generate package documentation. You can see the results for <a href="http://mirage.github.io/">Mirage</a> online, but expect to see this integrated into the main OCaml site for all OPAM packages as we work through polishing up the user interface.</p>
<h4 id="turning-opam-into-libraries">Turning OPAM into libraries</h4>
<p>The other behind-the-scenes effort for OPAM has been to keep the core command-line tool simple and stable, and to have it install OCaml libraries that can be interfaced with by other tools to do domain-specific tasks. <a href="http://gazagnaire.org">Thomas Gazagnaire</a>, <a href="http://louis.gesbert.fr/cv.en.html">Louis Gesbert</a> and <a href="https://github.com/dsheets">David Sheets</a> have been steadily hacking away at this and we now have <a href="https://github.com/ocamllabs/opamfu">opamfu</a> to run operations over all packages, and an easy-to-template <a href="https://github.com/ocaml/opam2web">opam2web</a> that generates the live <a href="http://opam.ocaml.org">opam.ocaml.org</a> website.</p>
<p>This makes OPAM easier to deploy within other organizations that want to integrate it into their workflow. For example, the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/pkg/">software section</a> of the OCaml Labs website is regularly generated from a search of all OPAM packages tagged <code>ocamllabs</code>. We also used it to rewrite the entire OPAM repository <a href="https://github.com/ocaml/opam-repository/pull/1240">in one epic diff</a> to add external library dependencies via a <a href="https://github.com/ocaml/opam/pull/886/files">command-line shim</a>.</p>
<h4 id="opam-in-a-box">OPAM-in-a-Box</h4>
<p>All of this effort is geared towards making it easier to maintain reusable local OPAM installations. After several requests from big universities to help out their teaching needs, we’re putting together all the support needed to easily redistribute OPAM packages via an “<a href="https://github.com/ocaml/opam/issues/1035">OPAM-in-a-Box</a>” command that uses <a href="http://docker.io">Docker</a> containers to let you clone and do lightweight modifications of OCaml installations.</p>
<p>This will also be useful for anyone who’d like to run tutorials or teach OCaml, without having to rely on flaky network connectivity at conference venues: a problem we’ve <a href="http://amirchaudhry.com/fpdays-review">suffered from</a> too!</p>
<h3 id="core-compiler-1">Core Compiler</h3>
<p><a href="https://github.com/ocamllabs/compiler-hacking/wiki"><img src="graphics/ocl13rev/compiler-hacking-thumb.jpg" alt="Compiler Hacking" class="floater" /></a></p>
<p>Starting to work on a real compiler can often be a daunting prospect, and so one initiative we started this year is to host regular <a href="http://ocamllabs.github.io/compiler-hacking/2013/10/30/third-compiler-hacking-session.html">compiler hacking sessions</a> where people could find a <a href="https://github.com/ocamllabs/compiler-hacking/wiki">curated list of features</a> to work on, with the regular developers at hand to help out when people get stuck, and free beer and pizza to oil the coding wheels. This has worked out well, with around 20 people showing up on average for the three we held, and <a href="https://github.com/ocamllabs/compiler-hacking/wiki/Things-previously-worked-on">several patches</a> submitted upstream to OCaml. <a href="http://gallium.inria.fr/~scherer/">Gabriel Scherer</a> and <a href="http://cristal.inria.fr/~doligez/">Damien Doligez</a> have been helping this effort by tagging <a href="http://caml.inria.fr/mantis/search.php?project_id=1&amp;sticky_issues=1&amp;sortby=last_updated&amp;dir=DESC&amp;highlight_changed=24&amp;hide_status_id=90&amp;tag_string=junior_job">junior jobs</a> in the OCaml Mantis bug tracker as they are filed.</p>
<h4 id="syntax-transformations-and-extension-points">Syntax transformations and extension points</h4>
<p><a href="http://www.lpw25.net">Leo White</a> started the year fresh out of completing his PhD with <a href="https://www.cl.cam.ac.uk/~am21/">Alan Mycroft</a>, and before he realized what he’d gotten himself into was working with <a href="http://alain.frisch.fr/">Alain Frisch</a> on the future of syntax transformations in OCaml. We started off our first <a href="http://lists.ocaml.org/listinfo/wg-camlp4">wg-camlp4</a> working group on the new <a href="http://lists.ocaml.org">lists.ocaml.org</a> host, and a spirited discussion <a href="http://lists.ocaml.org/pipermail/wg-camlp4/2013-January/thread.html">started</a> that went <a href="http://lists.ocaml.org/pipermail/wg-camlp4/2013-February/thread.html">on</a> and <a href="http://lists.ocaml.org/pipermail/wg-camlp4/2013-March/thread.html">on</a> for several months. It ended with a very satisfying design for a simpler <em>extension points</em> mechanism which Leo <a href="http://ocaml.org/meetings/ocaml/2013/slides/white.pdf">presented</a> at the OCaml 2013 workshop at ICFP, and is now merged into OCaml 4.02-trunk.</p>
<h4 id="namespaces">Namespaces</h4>
<p>Not all of the working groups were quite as successful in coming to a conclusion as the Camlp4 one. On the Platform mailing list, Gabriel Scherer started a discussion on the design for <a href="http://lists.ocaml.org/pipermail/platform/2013-February/000050.html">namespaces</a> in OCaml. The resulting discussion was useful in separating multiple concerns that were intermingled in the initial proposal, and Leo wrote a <a href="http://www.lpw25.net/2013/03/10/ocaml-namespaces.html">comprehensive blog post</a> on a proposed namespace design.</p>
<p>After further discussion at <a href="http://icfpconference.org/icfp2013/">ICFP 2013</a> with Jacques Garrigue later in the year, it turns out adding support for <a href="http://caml.inria.fr/mantis/view.php?id=6063">module aliases</a> would solve much of the cost associated with compiling large libraries such as <a href="http://ocaml.janestreet.com">Core</a>, with no backwards compatibility issues. This solution has now been integrated into OCaml 4.02.0dev and is being tested with Core.</p>
<h4 id="delving-into-the-bug-tracker">Delving into the bug tracker</h4>
<p>Jeremy Yallop joined us in April, and he and Leo also leapt into the core compiler and started triaging issues on the OCaml <a href="http://caml.inria.fr/mantis">bug tracker</a>. This seems unglamorous in the beginning, but there rapidly turned out to be many fascinating threads that shed light on OCaml’s design and implementation through seemingly harmless bugs. Here is a pick of some interesting threads through the year that we’ve been involved with:</p>
<ul>
<li>An <a href="http://caml.inria.fr/mantis/view.php?id=5985&amp;nbn=49#bugnotes">unexpected interaction between variance and GADTs</a> that led to Jacques Garrigue’s <a href="http://ocaml.org/meetings/ocaml/2013/slides/garrigue.pdf">talk</a> at OCaml 2013.</li>
<li>Type unsoundness by <a href="http://caml.inria.fr/mantis/view.php?id=5992">pattern matching lazy mutable values</a>, thus shedding light on the precise semantics of the order of pattern matching.</li>
<li>Leo proposed an <a href="http://caml.inria.fr/mantis/view.php?id=5584">open types</a> extension to allow abstract types to be declared open. You can try it via <code>opam switch 4.00.1+open-types</code>.</li>
<li>Designing the popular, but controversial <a href="http://caml.inria.fr/mantis/view.php?id=5759">record disambiguation feature</a> in OCaml 4.01.0, and debating <a href="http://caml.inria.fr/mantis/view.php?id=6000">the right warnings</a> needed to prevent programmer surprise.</li>
<li>Exposing a <a href="http://caml.inria.fr/mantis/view.php?id=6064">GADT representation for Bigarray</a>.</li>
</ul>
<p>This is just a sample of some of the issues solved in Mantis; if you want to learn more about OCaml, it’s well worth browsing through it to learn from over a decade of interesting discussions from all the developers.</p>
<h4 id="thread-local-storage-runtime">Thread-local storage runtime</h4>
<p>While OCamlPro was working on their <a href="https://github.com/lucasaiu/ocaml">reentrant OCaml runtime</a>, we took a different tack by adding <a href="https://github.com/ocamllabs/ocaml/tree/multicore">thread-local storage</a> to the runtime instead, courtesy of <a href="http://mu.netsoc.ie/">Stephen Dolan</a>. This is an important choice to make at the outset of adding multicore, so both approaches are warranted. The preemptive runtime adds a lot of code churn (due to adding a context parameter to most function calls) and takes up a register, whereas the thread-local storage approach we tried doesn’t permit callbacks to different threads.</p>
<p>Much of this work isn’t interesting on its own, but forms the basis for a fully multicore runtime (with associated programming model) in 2014. Stay tuned!</p>
<h4 id="ctypes">Ctypes</h4>
<p>[graphics/ocl13rev/c.png]{.floater} One other complaint from the Consortium members was quite surprising: the difficulty of using the OCaml foreign function interface safely to interface with C code. Jeremy Yallop began working on the <a href="https://github.com/ocamllabs/ocaml-ctypes">ctypes</a> library that had the goal of eliminating the need to write any C code at all for the vast majority of foreign bindings.</p>
<p>Instead, Ctypes lets you describe any C function call as an OCaml value, and provides various linkage options to invoke that function into C. The first option he implemented was a <code>dlopen</code> interface, which immediately brought us the same level of functionality as the <a href="http://docs.python.org/2/library/ctypes.html">Python</a> or <a href="http://www.haskell.org/haskellwiki/Library/libffi">Haskell</a> Ctypes equivalents. This early code was in itself startlingly useful and more pleasant to use than the raw FFI, and various folk (such as David Sheets’ <a href="https://github.com/dsheets/ocaml-sodium">libsodium</a> cryptography bindings) started adopting it.</p>
<p>At this point, I happened to be struggling to write the Foreign Function Interface chapter of <a href="https://realworldocaml.org">Real World OCaml</a> without blowing through our page budget with a comprehensive explanation of the existing system. I decided to take a risk and write about Ctypes instead, since it let new users to the language have a <em>far</em> more productive experience to get started. Xavier Leroy pointed out <a href="https://github.com/realworldocaml/book/issues/1701">some shortcomings</a> of the library in his technical book review, most notably with the lack of an interface with C macros. The design of Ctypes fully supports alternate linking mechanisms than just <code>dlopen</code> though, and Jeremy has added automatic C stub generation support as well. This means that if you use Ctypes to build an OCaml binding in 2014, you can choose several mechanisms for the same source code to link to the external system. Jeremy even demonstrated a forking model at OCaml 2013 that protects the OCaml runtime from the C binding via process separation.</p>
<p>The effort is paying off: Daniel Bünzli <a href="http://alan.petitepomme.net/cwn/2013.12.17.html#9">ported SDL2</a> using ctypes, and gave us extensive <a href="https://github.com/ocamllabs/ocaml-ctypes/issues">feedback</a> about any missing corner cases, and the resulting bindings don’t require any C code to be written. <a href="http://xulforum.org">Jonathan Protzenko</a> even used it to implement an OCaml controller for the <a href="http://gallium.inria.fr/blog/raspi-lcd/">Adafruit Raspberry Pi RGB LCD</a>!</p>
<h3 id="community-efforts">Community Efforts</h3>
<p>Our community efforts were largely online, but we also hosted visitors over the year and regular face-to-face tutorials.</p>
<h4 id="online-at-ocaml.org">Online at OCaml.org</h4>
<p><img src="graphics/ocl13rev/ocaml-org-thumb.png" alt="OCaml.org" class="floater" /> While the rest of the crew were hacking on OPAM and OCaml, <a href="http://amirchaudhry.com/">Amir Chaudhry</a> and <a href="http://philippewang.info/CL/">Philippe Wang</a> teamed up with Ashish Agarwal and Christophe Troestler to redesign and relaunch the <a href="http://ocaml.org">OCaml website</a>. Historically, OCaml’s homepage has been the <a href="http://caml.inria.fr">caml.inria.fr</a> domain, and the <a href="http://ocaml.org">ocaml.org</a> effort was begun by Christophe and Ashish <a href="https://www.mail-archive.com/caml-list@inria.fr/msg00169.html">some years ago</a> to modernize the web presence.</p>
<p>The webpages were already rather large with complex scripting (for example, the <a href="http://ocaml.org/learn/tutorials/99problems.html">99 Problems</a> page runs the OCaml code to autogenerate the output). Philippe developed a <a href="https://github.com/pw374/MPP-language-blender">template DSL</a> that made it easier to unify a lot of the templates around the website, and also a <a href="https://github.com/pw374/omd">Markdown parser</a> that we could link to as a library from the rest of the infrastructure without shelling out to Pandoc.</p>
<p>Meanwhile, Amir designed a series of <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">interactive wireframe sketches</a> and [gathered feedback]((http://amirchaudhry.com/ocamlorg-request-for-feedback/) on it from the community. A local <a href="http://onespacemedia.com">design agency</a> in Cambridge helped with visual look and feel, and finally at the end of the summer we began the <a href="http://amirchaudhry.com/migration-plan-ocaml-org/">migration</a> to the new website, followed by a triumphant <a href="http://amirchaudhry.com/announcing-new-ocamlorg/">switchover</a> in November to the design you see today.</p>
<p>The domain isn’t just limited to the website itself. Leo and I set up a <a href="https://github.com/ocaml/ocaml.org-scripts">SVN-to-Git mirror</a> of the OCaml compiler <a href="http://caml.inria.fr/ocaml/anonsvn.en.html">Subversion repository</a> on the GitHub <a href="https://github.com/ocaml/ocaml">OCaml organization</a>, which is proving popular with developers. There is an ongoing effort to simplify the core compiler tree by splitting out some of the larger components, and so <a href="http://github.com/ocaml/camlp4">camlp4</a> is also now hosted on that organization, along with <a href="https://github.com/ocaml/oasis">OASIS</a>. We also administer several subdomains of <a href="http://ocaml.org">ocaml.org</a>, such as the <a href="http://lists.ocaml.org">mailing lists</a> and the <a href="http://opam.ocaml.org">OPAM repository</a>, and other services such as the <a href="http://forge.ocamlcore.org">OCaml Forge</a> are currently migrating over. This was made significantly easier thanks to sponsorship from <a href="http://rackspace.com">Rackspace Cloud</a> (users of <a href="http://xenserver.org">XenServer</a> which is written in OCaml). They saw our struggles with managing physical machines and gave us developer accounts, and all of the ocaml.org infrastructure is now hosted on Rackspace. We’re very grateful to their ongoing help!</p>
<p><img src="graphics/ocl13rev/rackspace.png" alt="Rackspace" class="floater" /> If you’d like to contribute to infrastructure help (for example, I’m experimenting with a <a href="http://git.ocaml.org/public/">GitLab</a> mirror), then please join the <a href="http://lists.ocaml.org/listinfo/infrastructure">infrastructure@lists.ocaml.org</a> mailing list and share your thoughts. The website team also need help with adding content and <a href="https://github.com/ocaml/ocaml.org/issues/376">international translations</a>, so head over to the <a href="http://github.com/ocaml/ocaml.org/issues">website issue tracker</a> and start proposing improvements you’d like to see.</p>
<h4 id="next-steps-for-ocaml.org">Next steps for ocaml.org</h4>
<p>The floodgates requesting features opened up after the launch of the new look and feel. Pretty much everyone wanted deeper OPAM integration into the main website, for features such as:</p>
<ul>
<li>Starring and reviewing packages</li>
<li>Integrating the <a href="https://github.com/ocamllabs/opam-doc">opam-doc</a> documentation with the metadata</li>
<li>Display test results and a compatibility matrix for non-x86 and non-Linux architectures.</li>
<li>Link to blog posts and tutorials about the package.</li>
</ul>
<p>Many of these features were part of the <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">original wireframes</a> but we’re being careful to take a long-term view of how they should be created and maintained. Rather than building all of this as a huge bloated <a href="https://github.com/ocaml/opam2web">opam2web</a> extension, David Sheets (our resident relucant-to-admit-it web expert) has designed an overlay directory scheme that permits the overlaying of different metadata onto the website. This lets one particular feature (such as blog post aggregation) be handled separately from the others via Atom aggregators.</p>
<h4 id="real-world-ocaml"> Real World OCaml</h4>
<p><img src="graphics/ocl13rev/rwo.png" alt="Real World OCaml" class="floater" /> A big effort that took up most of the year for me was finishing and publishing an O’Reilly book called <a href="https://realworldocaml.org">Real World OCaml</a> with <a href="https://ocaml.janestreet.com/?q=blog/5">Yaron Minsky</a> and Jason Hickey. Yaron describes how it all started in <a href="https://ocaml.janestreet.com/?q=node/117">his blog post</a>, but I learnt a lot from developing a book using the <a href="http://anil.recoil.org/2013/06/17/real-world-ocaml-beta-available.html">open commenting scheme</a> that we developed just for this.</p>
<p>In particular, the book ended up shining a bright light into dark language corners that we might otherwise not have explored in OCaml Labs. Two chapters of the book that I wasn’t satisfied with were the <a href="https://realworldocaml.org/v1/en/html/objects.html">objects</a> and <a href="https://realworldocaml.org/v1/en/html/classes.html">classes</a> chapters, largely since neither Yaron nor Jason nor I had ever really used their full power in our own code. Luckily, Leo White decided to pick up the baton and champion these oft-maligned (but very powerful) features of OCaml, and the result is the clearest explanation of them that I’ve read yet. Meanwhile, Jeremy Yallop helped out with extensive review of the <a href="https://realworldocaml.org/v1/en/html/foreign-function-interface.html">Foreign Function Interface</a> chapter that used his <a href="https://github.com/ocamllabs/ocaml-ctypes">ctypes</a> library. Finally, <a href="https://plus.google.com/100586365409172579442/posts">Jeremie Diminio</a> at Jane Street worked hard on adding several features to his <a href="https://github.com/diml/utop">utop</a> toplevel that made it compelling enough to become our default recommendation for newcomers.</p>
<p>All in all, we ended up closing over <a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2.html">2000 comments</a> in the process of writing the book, and I’m very proud of the result (freely available <a href="https://realworldocaml.org">online</a>, but do <a href="http://www.amazon.com/Real-World-OCaml-Functional-programming/dp/144932391X/">buy a copy</a> if you can to support it). Still, there’s more I’d like to do in 2014 to improve the ease of using OCaml further. In particular, I removed a chapter on packaging and build systems since I wasn’t happy with its quality, and both <a href="http://gazagnaire.org">Thomas Gazagnaire</a> and I intend to spend time in 2014 on improving this part of the ecosystem.</p>
<h4 id="tutorials-and-talks">Tutorials and Talks</h4>
<p>We had a lively presence at <a href="http://icfpconference.org">ICFP 2013</a> this year, with the third iteration of the <a href="http://ocaml.org/meetings/ocaml/2013/program.html">OCaml 2013</a> held there, and Stephen Dolan presenting a paper in the main conference. I <a href="http://www.syslog.cl.cam.ac.uk/2013/09/24/liveblogging-ocaml-workshop-2013/">liveblogged OCaml 2013</a> and <a href="http://www.syslog.cl.cam.ac.uk/2013/09/22/liveblogging-cufp-2013/">CUFP 2013</a> as they happened, and all the <a href="http://ocaml.org/meetings/ocaml/2013/program.html">talks</a> we gave are linked from the program. The most exciting part of the conference for a lot of us were the two talks by Facebook on their use of OCaml: first for <a href="http://ocaml.org/meetings/ocaml/2013/slides/padioleau.pdf">program analysis using Pfff</a> and then to migrate their massive PHP codebase <a href="http://www.youtube.com/watch?feature=player_detailpage&amp;v=gKWNjFagR9k#t=1150">using an OCaml compiler</a>. I also had the opportunity to participate in a panel at the Haskell Workshop on whether <a href="http://ezyang.tumblr.com/post/62157468762/haskell-haskell-and-ghc-too-big-to-fail-panel">Haskell is too big to fail yet</a>; lots of interesting perspectives on scaling another formerly academic language into the real world.</p>
<p><a href="https://ocaml.janestreet.com/?q=blog/5">Yaron Minsky</a> and I have been giving tutorials on OCaml at ICFP for several years, but the release of Real World OCaml has made it significantly easier to give tutorials without the sort of labor intensity that it took in previous years (one memorable ICFP 2011 tutorial that we did took almost 2 hours to get everyone installed with OCaml. In ICFP 2013, it took us 15 minutes or so to get everyone started). Still, giving tutorials at ICFP is very much preaching to the choir, and so we’ve started speaking at more general-purpose events.</p>
<div class="figure">
<img src="graphics/ocl13rev/pfff.jpg" alt="Julien Verlaguet and Yoann Padioleau show off Pfff code visualisation at Facebook" />
<p class="caption">Julien Verlaguet and Yoann Padioleau show off Pfff code visualisation at Facebook</p>
</div>
<div class="figure">
<img src="graphics/ocl13rev/marius-yaron-icfp.jpg" alt="Marius Eriksen and Yaron Minsky start a Scala vs OCaml rap battle at the ICFP industrial fair. Maybe." />
<p class="caption">Marius Eriksen and Yaron Minsky start a Scala vs OCaml rap battle at the ICFP industrial fair. Maybe.</p>
</div>
<div class="figure">
<img src="graphics/ocl13rev/fpdays2013-04.jpg" alt="&gt;A successful FPDays tutorial in Cambridge, with all attendees getting a free copy of Real World OCaml" />
<p class="caption">&gt;A successful FPDays tutorial in Cambridge, with all attendees getting a free copy of Real World OCaml</p>
</div>
<p>Our first local effort was <a href="http://fpdays.net/2013/">FPDays</a> in Cambridge, where Jeremy Yallop and Amir Chaudhry ran the tutorial with help from Phillipe Wang, Leo White and David Sheets. The OCaml session there ended up being the biggest one in the entire two days, and Amir <a href="http://amirchaudhry.com/fpdays-review/">wrote up</a> their experiences. One interesting change from our ICFP tutorial is that Jeremy used <a href="https://github.com/ocsigen/js_of_ocaml">js_of_ocaml</a> to teach OCaml via JavaScript by building a fun <a href="https://github.com/ocamllabs/fpdays-skeleton">Monty Hall</a> game.</p>
<h4 id="visitors-and-interns-1">Visitors and Interns</h4>
<p><img src="graphics/ocl13rev/thomas-nycoug-2013.jpg" alt="Visitors" /> Since OCaml Labs is a normal group within the <a href="http://www.cl.cam.ac.uk">Cambridge Computer Lab</a>, we often host academic visitors and interns who pass through. This year was certainly diverse, and we welcomed a range of colleagues:</p>
<ul>
<li><a href="http://www.lip6.fr/actualite/personnes-fiche.php?ident=D1161&amp;LANG=en">Mathias Bourgoin</a> has just finished his work on interfacing OCaml with GPUs, and gave us a seminar on how his <a href="http://www.algo-prog.info/spoc/web/index.php?id=spoc">SPOC</a> tool works (also available in OPAM via a <a href="http://www.algo-prog.info/spoc/distribution/opam/">custom remote</a>).</li>
<li><a href="http://www.benjamin.canou.fr/">Benjamin Canou</a> (now at OCamlPro) practised his <a href="http://ocaml.org/meetings/ocaml/2013/slides/canou.pdf">OCaml 2013 talk</a> on building high-level interfaces to JavaScript with OCaml by giving a departmental seminar.</li>
<li><a href="http://www.dicosmo.org/">Roberto Di Cosmo</a>, who directs the <a href="http://www.irill.org/">IRILL</a> organization on Free Software in Paris delivered a seminar on constraint solving for <a href="http://mancoosi.org">package systems</a> that are as large-scale as Debian’s.</li>
<li><a href="http://gazagnaire.org">Thomas Gazagnaire</a> visited during the summer to help plot the <a href="http://openmirage.org/blog/mirage-1.0.3-released">Mirage 1.0</a> and <a href="http://anil.recoil.org/2013/09/20/opam-1-1-beta.html">OPAM 1.1</a> releases. He has also since joined OCaml Labs fulltime to work on <a href="http://nymote.org">Nymote</a>.</li>
<li><a href="http://louis.gesbert.fr/cv.en.html">Louis Gesbert</a> from OCamlPro visited for 2 weeks in December and kicked off the inaugral OPAM developers summit (which was, admittedly, just 5 developers in the <a href="http://www.kingston-arms.co.uk/">Kingston Arms</a>, but all good things start in a pub, right?)</li>
<li><a href="http://www.xulforum.org/">Jonathan Protzenko</a> presented his PhD work on <a href="http://protz.github.io/mezzo/">Mezzo</a> (which is now <a href="http://gallium.inria.fr/blog/mezzo-on-opam/">merged into OPAM</a>), and educated us on the vagaries of <a href="http://protz.github.io/ocaml-installer/">Windows support</a>.</li>
<li><a href="http://gallium.inria.fr/~scherer/">Gabriel Scherer</a> from the Gallium INRIA group visited to discuss the direction of OPAM and various language feature discussions (such as namespaces). He didn’t give a talk, but promises to do so next time!</li>
<li><a href="https://github.com/bvaugon">Benoît Vaugon</a> gave a seminar on his <a href="http://oud.ocaml.org/2012/slides/oud2012-paper10-slides.pdf">OCamlCC</a> OCaml-to-C compiler, talked about porting OCaml to <a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php?id=ocapic">8-bit PICs</a>, and using GADTs to <a href="http://caml.inria.fr/mantis/view.php?id=6017">implement Printf</a> properly.</li>
</ul>
<p>We were also visited several times by <a href="http://danmey.org/">Wojciech Meyer</a> from ARM, who was an OCaml developer who maintained (among other things) the <a href="http://brion.inria.fr/gallium/index.php/Ocamlbuild">ocamlbuild</a> system and worked on <a href="http://www.youtube.com/watch?v=d9Hg5L76FG8">DragonKit</a> (an extensible LLVM-like compiler written in OCaml). Wojciech very sadly passed away on November 18th, and we all fondly remember his enthusiastic and intelligent contributions to our small Cambridge community.</p>
<p>We also hosted visitors to live in Cambridge and work with us over the summer. In addition to Vincent Botbol (who worked on OPAM-doc as described earlier) we had the pleasure of having <a href="http://erratique.ch/">Daniel Bünzli</a> and <a href="http://www.x9c.fr/">Xavier Clerc</a> work here. Here’s what they did in their own words.</p>
<h5 id="xavier-clerc-ocamljava">Xavier Clerc: OCamlJava</h5>
<p>Xavier Clerc took a break from his regular duties at INRIA to join us over the summer to work on <a href="http://ocamljava.x9c.fr/preview/">OCaml-Java</a> and adapt it to the latest JVM features. This is an incredibly important project to bridge OCaml with the huge Java community, and here’s his report:</p>
<blockquote>
<p>After a four-month visit to the OCaml Labs dedicated to the <a href="http://ocamljava.x9c.fr/preview/">OCaml-Java</a> project, the time has come for an appraisal! The undertaken work can be split into two areas: improvements to code generation, and interaction between the OCaml &amp; Java languages. Regarding code generation, several classical optimizations have been added to the compiler, for example loop unrolling, more aggressive unboxing, better handling of globals, or partial evaluation (at the bytecode level). A new tool, namely ocamljar, has been introduced allowing post-compilation optimizations. The underlying idea is that some optimizations cannot always be applied (e.g. depending whether multiple threads/programs will coexist), but enabling them through command-line flags would lead to recompilation and/or multiple installations of each library according to the set of chosen optimizations. It is thus far more easier to first build an executable jar file, and then modify it according to these optimizations. Furthermore, this workflow allows the ocamljar tool to take advantage of whole-program information for some optimizations. All these improvements, combined, often lead to a gain of roughly 1/3 in terms of execution time.</p>
<p>Regarding language interoperability, there are actually two directions depending on whether you want to call OCaml code from Java, or want to call Java code from OCaml. For the first direction, a tool allows to generate Java source files from OCaml compiled interfaces, mapping the various constructs of the OCaml language to Java classes. It is then possible to call functions, and to manipulate instances of OCaml types in pure Java, still benefiting from the type safety provided by the OCaml language. In the other direction, an extension of the OCaml typer is provided allowing to create and manipulate Java instances directly from OCaml sources. This typer extension is indeed a thin layer upon the original OCaml typer, that is mainly responsible for encoding Java types into OCaml types. This encoding uses a number of advanced elements such as polymorphic variants, subtyping, variance annotations, phantom typing, and printf-hack, but the end-user does not have to be aware of this encoding. On the surface, the type of instances of the Java Object classes is <code>java'lang'Object java_instance</code>, and instances can be created by calling Java.make <code>Object()</code>.</p>
<p>While still under heavy development, a working prototype <a href="http://ocamljava.x9c.fr/preview/">is available</a>, and bugs <a href="http://bugs.x9c.fr/">can be reported</a>. Finally, I would like to thank the OCaml Labs for providing a great working environment.</p>
</blockquote>
<h5 id="daniel-bünzli-typography-and-visualisation">Daniel Bünzli: Typography and Visualisation</h5>
<p><img src="graphics/ocl13rev/daniel-presentation-vg.jpg" alt="Bunzli" /> Daniel joined us from Switzerland, and spent some time at Citrix before joining us in OCaml Labs. All of his <a href="http://erratique.ch/software">software</a> is now on OPAM, and is seeing ever-increasing adoption from the community.</p>
<blockquote>
<p>Released a first version of <a href="http://erratique.ch/software/vg">Vg</a> […] I’m especially happy about that as I wanted to use and work on these ideas since at least 2008. The project is a long term project and is certainly not finished yet but this is already a huge step.</p>
<p>Adjusted and released a first version of <a href="http://erratique.ch/software/gg">Gg</a>. While the module was already mostly written before my arrival to Cambridge, the development of Vg and Vz prompted me to make some changes to the module.</p>
<p>[…] released <a href="http://erratique.ch/software/otfm">Otfm</a>, a module to decode OpenType fonts. This is a work in progress as not every OpenType table has built-in support for decoding yet. But since it is needed by Vg’s PDF renderer I had to cut a release. It can however already be used to implement certain simple things like font kerning with Vg, this can be seen in action in the <code>vecho</code> binary installed by Vg.</p>
<p>Started to work on <a href="http://erratique.ch/software/vz/doc/Vz.html">Vz</a>, a module for helping to map data to Vg images. This is really unfinished and is still considered to be at a design stage. There are a few things that are however well implemented like (human) perceptually meaningful <a href="http://erratique.ch/software/vz/demos/color_schemes.html">color palettes</a> and the small folding stat module (<code>Vz.Stat</code>). However it quickly became evident that I needed to have more in the box w.r.t. text rendering in Vg/Otfm. Things like d3js entirely rely on the SVG/CSS support for text which makes it easy to e.g. align things (like tick labels on <a href="http://erratique.ch/software/vz/demos/iris.html">such drawings</a>). If you can’t rely on that you need ways of measuring rendered text. So I decided to suspend the work on Vz and put more energy in making a first good release of Vg. Vz still needs quite some design work, especially since it tries to be independent of Vg’s backend and from the mechanism for user input.</p>
<p>Spent some time figuring out a new “opam-friendly” release workflow in pkgopkg. One of my problem is that by designing in the small for programming in the large — what a slogan — the number of packages I’m publishing is growing (12 and still counting). This means that I need to scale horizontally maintenance-wise unhelped by the sad state of build systems for OCaml. I need tools that make the release process flawless, painless and up to my quality standards. This lead me to enhance and consolidate my old scattered distribution scripts in that repo, killing my dependencies on Oasis and ocamlfind along the way. <em>(edited for brevity, see <a href="https://github.com/dbuenzli/pkgopkg">here</a>)</em></p>
</blockquote>
<p>Daniel also left his bicycle here for future visitors to use, and the “Bünzli-bike” is available for our next visitor! (Louis Gesbert even donated lights, giving it a semblance of safety).</p>
<h4 id="industrial-fellows">Industrial Fellows</h4>
<p>Most of our regular funding bodies such as <a href="http://epsrc.ac.uk">EPSRC</a> or <a href="http://cordis.europa.eu/fp7/home_en.html">EU FP7</a> provide funding, but leave all the intellectual input to the academics. A compelling aspect of OCaml Labs has been how involved our industrial colleagues have been with the day-to-day problems that we solve. Both Jane Street and Citrix have senior staff regularly visiting our group and working alongside us as industrial fellows in the Computer Lab.</p>
<ul>
<li><p><img src="graphics/ocl13rev/js.jpg" alt="Jane Street" /> <a href="http://www.three-tuns.net/mark/">Mark Shinwell</a> from Jane Street Europe has been working on improving the <a href="http://www.youtube.com/watch?v=NF2WpWnB-nk">state of native debugging</a> in OCaml, by adding extended DWARF debugging information to the compiler output. Mark is also a useful source of feedback about the forthcoming design of multicore, since he has daily insight into a huge production codebase at Jane Street (and can tell us about it without us requiring access!).</p></li>
<li><p><img src="graphics/ocl13rev/xenserver.png" alt="XenServer" /> <a href="http://dave.recoil.org">Dave Scott</a> is the principal architect of <a href="http://xenserver.org">XenServer</a> at Citrix in Cambridge. This year has been transformative for that project, since Citrix <a href="http://blogs.citrix.com/2013/06/26/open-source-what-does-it-mean-for-xenserver/">open-sourced XenServer</a> to GitHub and fully adopted OPAM into their workflow. Dave is the author of numerous libraries that have all been released to OPAM, and his colleagues <a href="http://jon.recoil.org">Jon Ludlam</a> and <a href="http://www.xenserver.org/blog/blogger/listings/euanh.html">Euan Harris</a> are also regular visitors who have also been contributors to the OPAM and Mirage ecosystems.</p></li>
</ul>
<h3 id="research-projects">Research Projects</h3>
<p>The other 100% of our time at the Labs is spent on research projects. When we started the group, I wanted to set up a feedback loop between local people <em>using</em> OCaml to build systems, with the folk <em>developing</em> OCaml itself. This has worked out particularly well with a couple of big research projects in the Lab.</p>
<h4 id="mirage"> Mirage</h4>
<p>Mirage is a <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">library operating system</a> written in OCaml that compiles source code into specialised Xen microkernels, developed at the Cambridge Computer Lab, Citrix and the <a href="http://horizon.ac.uk">Horizon Digital Economy</a> institute at Nottingham. This year saw several years of effort culminate in the first release of <a href="http://openmirage.org">Mirage 1.0</a> as a self-hosting entity. While Mirage started off as a <a href="http://anil.recoil.org/papers/2010-hotcloud-lamp.pdf">quick experiment</a> into building specialised virtual appliances, it rapidly became useful to make into a real system for use in bigger research projects. You can learn more about Mirage <a href="http://openmirage.org/docs">here</a>, or read the <a href="http://cacm.acm.org/magazines/2014/1/170866-unikernels/abstract">Communications of the ACM</a> article that <a href="http://dave.recoil.org">Dave Scott</a> and I wrote to close out the year.</p>
<p><img src="graphics/ocl13rev/mirageos.png" alt="MirageOS" /> This project is where the OCaml Labs “feedback loop” has been strongest. A typical <a href="http://www.openmirage.org/wiki/hello-world">Mirage application</a> consists of around 50 libraries that are all installed via OPAM. These range from <a href="https://github.com/mirage/mirage-block-xen">device drivers</a> to protocol libraries for <a href="https://github.com/avsm/ocaml-cohttp">HTTP</a> or <a href="https://github.com/mirage/ocaml-dns">DNS</a>, to filesystems such as <a href="https://github.com/mirage/ocaml-fat">FAT32</a>. Coordinating <a href="http://openmirage.org/blog/mirage-1.0.3-released">regular releases</a> of all of these would be near impossible without using OPAM, and has also forced us to use our own tools daily, helping to sort out bugs more quickly. You can see the full list of libraries on the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/pkg/">OCaml Labs software page</a>.</p>
<p>Mirage is also starting to share code with big projects such as <a href="http://xenserver.org">XenServer</a> now, and we have been working with Citrix engineers to help them to move to the <a href="http://ocaml.janestreet.com">Core</a> library that Jane Street has released (and that is covered in <a href="https://realworldocaml.org">Real World OCaml</a>). Moving production codebases this large can take years, but OCaml Labs is turning out to be a good place to start unifying some of the bigger users of OCaml into one place. We’re also now an official <a href="http://www.xenproject.org/developers/teams/mirage-os.html">Xen Project incubator project</a>, which helps us to validate functional programming to other Linux Foundation efforts.</p>
<h4 id="nymote-and-user-centric-networking">Nymote and User Centric Networking</h4>
<p><img src="graphics/ocl13rev/nymote.png" alt="Nymote" /> The release of Mirage 1.0 has put us on the road to simplifying embedded systems programming. The move to the centralized cloud has led to regular well-publicised privacy and security threats to the way <a href="http://de2013.org/wp-content/uploads/2013/09/de2013_submission_25-1.pdf">we handle</a> our digital infrastructure, and so <a href="http://www.cl.cam.ac.uk/~jac22/">Jon Crowcroft</a>, <a href="http://www.cs.nott.ac.uk/~rmm/">Richard Mortier</a> and I are leading an effort to build an alternative privacy-preserving infrastructure using embedded devices as part of the <a href="http://usercentricnetworking.eu/">User Centric Networking</a> project, in collaboration with a host of companies led by <a href="http://www.thlab.net/">Technicolor</a> Paris. This work also plays on the strong points of OCaml: it already has a <a href="http://anil.recoil.org/2012/02/25/dreamplug-debian-and-ocaml.html">fast ARM backend</a>, and Mirage can easily be ported to the new Xen/ARM target as hardware becomes available.</p>
<p>One of the most difficult aspects of programming on the “wide area” Internet are dealing with the lack of a distributed identity service that’s fully secure. We published <a href="http://anil.recoil.org/papers/2013-foci-signposts.pdf">our thoughts</a> on this at the USENIX Free and Open Communications on the Internet workhsop, and David Sheets is working towards a full implementation using Mirage. If you’re interested in following this effort, Amir Chaudhry is blogging at the <a href="http://nymote.org/">Nymote</a> project website, where we’ll talk about the components as they are released.</p>
<h4 id="data-center-networking"> Data Center Networking</h4>
<p>At the other extreme from embedded programming is datacenter networking, and we started the <a href="http://gow.epsrc.ac.uk/NGBOViewGrant.aspx?GrantRef=EP/K034723/1">Network-as-a-Service</a> research project with <a href="http://gow.epsrc.ac.uk/NGBOViewGrant.aspx?GrantRef=EP/K032968/1">Imperial College</a> and <a href="http://gow.epsrc.ac.uk/NGBOViewGrant.aspx?GrantRef=EP/K031724/1">Nottingham</a>. With the rapid rise of <a href="http://en.wikipedia.org/wiki/Software-defined_networking">Software Defined Networking</a> this year, we are investigating how application-specific customisation of network resources can build fast, better, cheaper infrasructure. OCaml is in a good position here: several other groups have built OpenFlow controllers in OCaml (most notably, the <a href="https://github.com/frenetic-lang">Frenetic Project</a>), and Mirage is specifically designed to assemble such bespoke infrastructure.</p>
<p>Another aspect we’ve been considering is how to solve the problem of optimal connectivity across nodes. TCP is increasingly considered harmful in high-through, high-density clusters, and <a href="http://www.sussex.ac.uk/informatics/people/peoplelists/person/334868">George Parisis</a> led the design of <a href="http://anil.recoil.org/papers/2013-hotnets-trevi.pdf">Trevi</a>, which is a fountain-coding based alternative for storage networking. Meanwhile, <a href="http://gazagnaire.org">Thomas Gazagnaire</a> (who joined OCaml Labs in November), has been working on a branch-consistent data store called <a href="https://github.com/samoht/irminsule">Irminsule</a> which supports scalable data sharing and reconciliation using Mirage. Both of these systems will see implementations based on the research done this year.</p>
<h4 id="higher-kinded-programming"> Higher Kinded Programming</h4>
<p>Jeremy Yallop and Leo White have been developing an approach that makes it possible to write programs with higher-kinded polymorphism (such as monadic functions that are polymorphic in the monad they use) without using functors. It’s early days yet, but there’s a <a href="https://github.com/ocamllabs/higher">library</a> available on <a href="http://opam.ocaml.org/pkg/higher/higher.0.1">OPAM</a> that implements the approach, and a <a href="https://github.com/ocamllabs/higher/raw/paper/higher.pdf">draft paper</a> that outlines the design.</p>
<h3 id="priorities-for-2014">Priorities for 2014</h3>
<p>This year has been a wild ride to get us up to speed, but we now have a solid sense of what to work on for 2014. We’ve decided on a high-level set of priorities led by the senior members of the group:</p>
<ul>
<li><strong>Multicore</strong>: Leo White will be leading efforts in putting an end-to-end multicore capable OCaml together.</li>
<li><strong>Metaprogramming</strong>: Jeremy Yallop will direct the metaprogramming efforts, continuing with Ctypes and into macros and extension points.</li>
<li><strong>Platform</strong>: Thomas Gazagnaire will continue to drive OPAM development towards becoming the first <a href="http://ocaml.org/meetings/ocaml/2013/slides/madhavapeddy.pdf">OCaml Platform</a>.</li>
<li><strong>Online</strong>: Amir Chaudhry will develop the online and community efforts that started in 2013.</li>
</ul>
<p>These are guidelines to choosing where to spend our time, but not excluding other work or day-to-day bugfixing. Our focus on collaboration with Jane Street, Citrix, Lexifi, OCamlPro and our existing colleagues will continue, as well as warmly welcoming new community members that wish to work with us on any of the projects, either via internships, studentships or good old-fashioned open source hacking.</p>
<p>I appreciate the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/">whole team’s</a> feedback in editing this long post into shape, the amazing professorial support from <a href="http://www.cl.cam.ac.uk/~jac22/">Jon Crowcroft</a>, <a href="https://www.cl.cam.ac.uk/~iml1/">Ian Leslie</a> and <a href="https://www.cl.cam.ac.uk/~am21/">Alan Mycroft</a> throughout the year, and of course the funding and support from Jane Street, Citrix, RCUK, EPSRC, DARPA and the EU FP7 that made all this possible. Roll on 2014, and please do <script type="text/javascript">
<!--
h='&#x63;&#108;&#46;&#x63;&#x61;&#x6d;&#46;&#x61;&#x63;&#46;&#x75;&#x6b;';a='&#64;';n='&#x61;&#118;&#x73;&#x6d;&#50;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+'&#x67;&#x65;&#116;&#32;&#x69;&#110;&#32;&#116;&#x6f;&#x75;&#x63;&#104;'+'<\/'+'a'+'>');
// -->
</script><noscript>&#x67;&#x65;&#116;&#32;&#x69;&#110;&#32;&#116;&#x6f;&#x75;&#x63;&#104;&#32;&#40;&#x61;&#118;&#x73;&#x6d;&#50;&#32;&#x61;&#116;&#32;&#x63;&#108;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x61;&#x6d;&#32;&#100;&#x6f;&#116;&#32;&#x61;&#x63;&#32;&#100;&#x6f;&#116;&#32;&#x75;&#x6b;&#x29;</noscript> with me with any queries!</p>
</body>
</html>
